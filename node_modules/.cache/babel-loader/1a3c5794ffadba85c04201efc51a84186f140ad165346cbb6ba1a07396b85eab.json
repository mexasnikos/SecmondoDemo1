{"ast":null,"code":"var _TerracottaService;\n/**\n * Terracotta Insurance Quote Integration Service\n * \n * This service handles all communication with the Terracotta Integrated Quote web service\n * using SOAP protocol. It provides methods for:\n * - Requesting quotes (ProvideQuotation)\n * - Updating quotes with additional covers (ProvideQuotationWithAlterations)\n * - Getting screening questions (ScreeningQuestions)\n * - Saving policy details (SavePolicyDetails)\n */\n\n// Import xmldom for Node.js XML parsing\nlet DOMParser;\nif (typeof window === 'undefined') {\n  // Node.js environment\n  const {\n    DOMParser: XMDOMParser\n  } = require('xmldom');\n  DOMParser = XMDOMParser;\n} else {\n  // Browser environment\n  DOMParser = window.DOMParser;\n}\n\n// Terracotta API Configuration\nconst TERRACOTTA_BASE_URL = 'https://www.asuaonline.com/ws/integratedquote.asmx';\nconst PROXY_BASE_URL = 'http://localhost:3001/api/terracotta';\nconst TERRACOTTA_USER_ID = '4072';\nconst TERRACOTTA_USER_CODE = '111427';\n\n// TypeScript interfaces for Terracotta API data structures\n\n/**\n * Helper function to decode HTML entities and format currency\n */\nfunction formatCurrencyLimit(htmlString) {\n  if (!htmlString) return '';\n\n  // Decode HTML entities\n  const textarea = document.createElement('textarea');\n  textarea.innerHTML = htmlString;\n  let decoded = textarea.value;\n\n  // Additional manual replacements for common entities\n  decoded = decoded.replace(/&euro;/gi, '€').replace(/&pound;/gi, '£').replace(/&dollar;/gi, '$').replace(/&amp;/gi, '&').replace(/&lt;/gi, '<').replace(/&gt;/gi, '>').replace(/&quot;/gi, '\"').replace(/&#39;/gi, \"'\");\n\n  // Format numbers with thousand separators\n  // Match patterns like €32000 or euro32000 and add commas\n  decoded = decoded.replace(/([€£$]|euro|pound|dollar)?\\s*(\\d{4,})/gi, (match, currency, number) => {\n    const formattedNumber = parseInt(number).toLocaleString('en-US');\n    return currency ? `${currency}${formattedNumber}` : formattedNumber;\n  });\n\n  // Fix spacing: \"Up to€32,000\" -> \"Up to €32,000\"\n  decoded = decoded.replace(/(\\w)([€£$])/g, '$1 $2');\n  return decoded;\n}\n\n/**\n * SOAP XML Builder utility functions\n */\nclass SOAPBuilder {\n  static createEnvelope(body) {\n    return `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<soap:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" \n               xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" \n               xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\">\n  <soap:Body>\n    ${body}\n  </soap:Body>\n</soap:Envelope>`;\n  }\n  static buildTravelerXML(traveler) {\n    return `\n      <Traveller>\n        <TravellerNumber>${traveler.TravellerNumber}</TravellerNumber>\n        <Title>${traveler.Title}</Title>\n        <FirstName>${traveler.FirstName}</FirstName>\n        <LastName>${traveler.LastName}</LastName>\n        <DateOfBirth>${traveler.DateOfBirth}</DateOfBirth>\n        <Age>${traveler.Age}</Age>\n        <AgebandID>${traveler.AgebandID || 0}</AgebandID>\n        <TitleID>${traveler.TitleID || 0}</TitleID>\n        <minAge>${traveler.minAge || traveler.Age}</minAge>\n        <maxAge>${traveler.maxAge || traveler.Age}</maxAge>\n        <AlterationID>${traveler.AlterationID || ''}</AlterationID>\n        <msPrice>${traveler.msPrice || 0}</msPrice>\n        <msPriceExcIPT>${traveler.msPriceExcIPT || 0}</msPriceExcIPT>\n        <msConditions>${traveler.msConditions || ''}</msConditions>\n        <ScreeningInformation xsi:nil=\"true\" />\n      </Traveller>`;\n  }\n  static buildContactDetailsXML(contact) {\n    return `\n      <ContactDetails>\n        <Address>${contact.Address}</Address>\n        <Postcode>${contact.Postcode}</Postcode>\n        <Email>${contact.Email}</Email>\n        <Telephone>${contact.Telephone}</Telephone>\n        ${contact.VehicleMakeModel ? `<VehicleMakeModel>${contact.VehicleMakeModel}</VehicleMakeModel>` : ''}\n        ${contact.VehicleLicensePlate ? `<VehicleLicensePlate>${contact.VehicleLicensePlate}</VehicleLicensePlate>` : ''}\n        ${contact.VehicleYearManufacture ? `<VehicleYearManufacture>${contact.VehicleYearManufacture}</VehicleYearManufacture>` : ''}\n      </ContactDetails>`;\n  }\n  static buildQuoteDetailsXML(details) {\n    const travelersXML = details.Travellers.map(traveler => this.buildTravelerXML(traveler)).join('');\n    const contactXML = this.buildContactDetailsXML(details.ContactDetails);\n    return `\n      <quoteDetails>\n        <ResidenceID>${parseInt(details.ResidenceID) || 1}</ResidenceID>\n        <TypePolicyID>${details.TypePolicyID}</TypePolicyID>\n        <TypePackageID>${parseInt(details.TypePackageID) || 1}</TypePackageID>\n        <Destination>${details.Destination}</Destination>\n        <StartDate>${details.StartDate}</StartDate>\n        <EndDate>${details.EndDate}</EndDate>\n        <Travellers>\n          ${travelersXML}\n        </Travellers>\n        ${contactXML}\n        ${details.includeAnnualQuotes !== undefined ? `<includeAnnualQuotes>${details.includeAnnualQuotes}</includeAnnualQuotes>` : ''}\n        ${details.includeUpsell !== undefined ? `<includeUpsell>${details.includeUpsell}</includeUpsell>` : ''}\n        ${details.currencyID ? `<currencyID>${details.currencyID}</currencyID>` : ''}\n        ${details.schemaIDFilter ? `<schemaIDFilter>${details.schemaIDFilter}</schemaIDFilter>` : ''}\n      </quoteDetails>`;\n  }\n  static buildScreeningAnswersXML(answers) {\n    return '<screeningQuestionAnswers>' + answers.map(answer => `\n        <screeningQuestionAnswer>\n          <questionNumber>${answer.questionNumber}</questionNumber>\n          <answer>${answer.answer}</answer>\n        </screeningQuestionAnswer>`).join('') + '</screeningQuestionAnswers>';\n  }\n  static buildEligibilityAnswersXML(answers) {\n    return '<EligibilityQuestionAnswers>' + answers.map(answer => `\n        <eligibilityQuestionAnswer>\n          <questionNumber>${answer.questionNumber}</questionNumber>\n          <answer>${answer.answer}</answer>\n        </eligibilityQuestionAnswer>`).join('') + '</EligibilityQuestionAnswers>';\n  }\n  static buildDynamicDetailsXML(details) {\n    return '<DynamicDetails>' + details.map(detail => `\n        <DynamicDetail_SavedValue>\n          <Position>${detail.Position}</Position>\n          <FieldName>${detail.FieldName}</FieldName>\n          <FieldValue>${detail.FieldValue}</FieldValue>\n          <FieldSize>${detail.FieldSize}</FieldSize>\n        </DynamicDetail_SavedValue>`).join('') + '</DynamicDetails>';\n  }\n  static buildSpecificQuoteDetailsXML(details) {\n    const travelersXML = details.Travellers.map(traveler => this.buildTravelerXML(traveler)).join('');\n    const contactXML = this.buildContactDetailsXML(details.ContactDetails);\n    const dynamicDetailsXML = details.DynamicDetails ? this.buildDynamicDetailsXML(details.DynamicDetails) : '';\n    const screeningAnswersXML = details.screeningQuestionAnswers ? this.buildScreeningAnswersXML(details.screeningQuestionAnswers) : '';\n    const eligibilityAnswersXML = details.EligibilityQuestionAnswers ? this.buildEligibilityAnswersXML(details.EligibilityQuestionAnswers) : '';\n    return `\n      <specificQuoteDetails>\n        <AlterationID>${details.AlterationID}</AlterationID>\n        <Travellers>\n          ${travelersXML}\n        </Travellers>\n        ${contactXML}\n        ${dynamicDetailsXML}\n        ${screeningAnswersXML}\n        ${eligibilityAnswersXML}\n      </specificQuoteDetails>`;\n  }\n}\n\n/**\n * XML Parser utility functions\n */\nclass XMLParser {\n  static getXMLParser() {\n    return new DOMParser();\n  }\n  static parseQuoteResponse(xmlText) {\n    try {\n      var _xmlDoc$querySelector;\n      const parser = new DOMParser();\n      const xmlDoc = parser.parseFromString(xmlText, 'text/xml');\n\n      // Check for parsing errors\n      const parseError = xmlDoc.querySelector('parsererror');\n      if (parseError) {\n        throw new Error(`XML parsing error: ${parseError.textContent}`);\n      }\n      const message = ((_xmlDoc$querySelector = xmlDoc.querySelector('message')) === null || _xmlDoc$querySelector === void 0 ? void 0 : _xmlDoc$querySelector.textContent) || '';\n      const quoteResults = [];\n\n      // Select only child quoteResults, not the parent container\n      // Handle both ProvideQuotation and ProvideQuotationWithAlterations responses\n      let quoteResultNodes = xmlDoc.querySelectorAll('ProvideQuotationResult > quoteResults > quoteResults');\n\n      // If not found, try ProvideQuotationWithAlterationsResult\n      if (quoteResultNodes.length === 0) {\n        quoteResultNodes = xmlDoc.querySelectorAll('ProvideQuotationWithAlterationsResult > quoteResults > quoteResults');\n      }\n\n      // If still not found, try without the parent Result element\n      if (quoteResultNodes.length === 0) {\n        quoteResultNodes = xmlDoc.querySelectorAll('quoteResults > quoteResults');\n      }\n      console.log(`📊 Found ${quoteResultNodes.length} quote result nodes in XML`);\n      quoteResultNodes.forEach(node => {\n        var _node$querySelector, _node$querySelector2, _node$querySelector3, _node$querySelector4, _node$querySelector5, _node$querySelector6, _node$querySelector7, _node$querySelector8, _node$querySelector9, _node$querySelector0, _node$querySelector1, _node$querySelector10, _node$querySelector11, _node$querySelector12, _node$querySelector13, _node$querySelector14, _node$querySelector15, _node$querySelector16, _node$querySelector17, _node$querySelector18, _node$querySelector19, _node$querySelector20, _node$querySelector21, _node$querySelector22, _node$querySelector23, _node$querySelector24, _node$querySelector25, _node$querySelector26, _node$querySelector27, _node$querySelector28, _node$querySelector29, _node$querySelector30, _node$querySelector31, _node$querySelector32, _node$querySelector33, _node$querySelector34, _node$querySelector35, _node$querySelector36, _node$querySelector37, _node$querySelector38, _node$querySelector39, _node$querySelector40, _node$querySelector41, _node$querySelector42, _node$querySelector43, _node$querySelector44;\n        // Only process nodes that have QuoteID (skip empty parent nodes)\n        const quoteID = ((_node$querySelector = node.querySelector('QuoteID')) === null || _node$querySelector === void 0 ? void 0 : _node$querySelector.textContent) || '';\n        if (!quoteID) {\n          console.log('⚠️ Skipping node without QuoteID');\n          return; // Skip empty nodes\n        }\n        console.log(`✅ Processing quote result with QuoteID: ${quoteID}`);\n        const result = {\n          QuoteID: quoteID,\n          schemaName: ((_node$querySelector2 = node.querySelector('schemaName')) === null || _node$querySelector2 === void 0 ? void 0 : _node$querySelector2.textContent) || '',\n          policytypeName: ((_node$querySelector3 = node.querySelector('policytypeName')) === null || _node$querySelector3 === void 0 ? void 0 : _node$querySelector3.textContent) || '',\n          residenceName: ((_node$querySelector4 = node.querySelector('residenceName')) === null || _node$querySelector4 === void 0 ? void 0 : _node$querySelector4.textContent) || '',\n          destinationName: ((_node$querySelector5 = node.querySelector('destinationName')) === null || _node$querySelector5 === void 0 ? void 0 : _node$querySelector5.textContent) || '',\n          startDate: ((_node$querySelector6 = node.querySelector('startDate')) === null || _node$querySelector6 === void 0 ? void 0 : _node$querySelector6.textContent) || '',\n          endDate: ((_node$querySelector7 = node.querySelector('endDate')) === null || _node$querySelector7 === void 0 ? void 0 : _node$querySelector7.textContent) || '',\n          SI: ((_node$querySelector8 = node.querySelector('SI')) === null || _node$querySelector8 === void 0 ? void 0 : _node$querySelector8.textContent) || '',\n          PW: ((_node$querySelector9 = node.querySelector('PW')) === null || _node$querySelector9 === void 0 ? void 0 : _node$querySelector9.textContent) || '',\n          KF: ((_node$querySelector0 = node.querySelector('KF')) === null || _node$querySelector0 === void 0 ? void 0 : _node$querySelector0.textContent) || '',\n          HelpFile: ((_node$querySelector1 = node.querySelector('HelpFile')) === null || _node$querySelector1 === void 0 ? void 0 : _node$querySelector1.textContent) || '',\n          currency: ((_node$querySelector10 = node.querySelector('currency')) === null || _node$querySelector10 === void 0 ? void 0 : _node$querySelector10.textContent) || '',\n          IPT: parseFloat(((_node$querySelector11 = node.querySelector('IPT')) === null || _node$querySelector11 === void 0 ? void 0 : _node$querySelector11.textContent) || '0'),\n          IPTRate: parseFloat(((_node$querySelector12 = node.querySelector('IPTRate')) === null || _node$querySelector12 === void 0 ? void 0 : _node$querySelector12.textContent) || '0'),\n          GrossPrice: parseFloat(((_node$querySelector13 = node.querySelector('GrossPrice')) === null || _node$querySelector13 === void 0 ? void 0 : _node$querySelector13.textContent) || '0'),\n          screeningPremium: parseFloat(((_node$querySelector14 = node.querySelector('screeningPremium')) === null || _node$querySelector14 === void 0 ? void 0 : _node$querySelector14.textContent) || '0'),\n          IconURL: ((_node$querySelector15 = node.querySelector('IconURL')) === null || _node$querySelector15 === void 0 ? void 0 : _node$querySelector15.textContent) || '',\n          SchemaID: parseInt(((_node$querySelector16 = node.querySelector('SchemaID')) === null || _node$querySelector16 === void 0 ? void 0 : _node$querySelector16.textContent) || '0'),\n          PolicyTypeID: parseInt(((_node$querySelector17 = node.querySelector('PolicyTypeID')) === null || _node$querySelector17 === void 0 ? void 0 : _node$querySelector17.textContent) || '0'),\n          DestinationID: parseInt(((_node$querySelector18 = node.querySelector('DestinationID')) === null || _node$querySelector18 === void 0 ? void 0 : _node$querySelector18.textContent) || '0'),\n          PackageID: parseInt(((_node$querySelector19 = node.querySelector('PackageID')) === null || _node$querySelector19 === void 0 ? void 0 : _node$querySelector19.textContent) || '0'),\n          MaxAgeAgebandID: parseInt(((_node$querySelector20 = node.querySelector('MaxAgeAgebandID')) === null || _node$querySelector20 === void 0 ? void 0 : _node$querySelector20.textContent) || '0'),\n          ScreeningID: parseInt(((_node$querySelector21 = node.querySelector('ScreeningID')) === null || _node$querySelector21 === void 0 ? void 0 : _node$querySelector21.textContent) || '0'),\n          groupPerProduct: ((_node$querySelector22 = node.querySelector('groupPerProduct')) === null || _node$querySelector22 === void 0 ? void 0 : _node$querySelector22.textContent) === 'true',\n          priceOrder: parseInt(((_node$querySelector23 = node.querySelector('priceOrder')) === null || _node$querySelector23 === void 0 ? void 0 : _node$querySelector23.textContent) || '0'),\n          IPID: ((_node$querySelector24 = node.querySelector('IPID')) === null || _node$querySelector24 === void 0 ? void 0 : _node$querySelector24.textContent) || '',\n          typePolicyName: ((_node$querySelector25 = node.querySelector('typePolicyName')) === null || _node$querySelector25 === void 0 ? void 0 : _node$querySelector25.textContent) || '',\n          typePackageName: ((_node$querySelector26 = node.querySelector('typePackageName')) === null || _node$querySelector26 === void 0 ? void 0 : _node$querySelector26.textContent) || '',\n          currencyHTMLEncoded: ((_node$querySelector27 = node.querySelector('currencyHTMLEncoded')) === null || _node$querySelector27 === void 0 ? void 0 : _node$querySelector27.textContent) || '',\n          AlterationID: ((_node$querySelector28 = node.querySelector('AlterationID')) === null || _node$querySelector28 === void 0 ? void 0 : _node$querySelector28.textContent) || '',\n          packageName: ((_node$querySelector29 = node.querySelector('packageName')) === null || _node$querySelector29 === void 0 ? void 0 : _node$querySelector29.textContent) || '',\n          isAnnual: parseInt(((_node$querySelector30 = node.querySelector('isAnnual')) === null || _node$querySelector30 === void 0 ? void 0 : _node$querySelector30.textContent) || '0'),\n          isBestBuy: parseInt(((_node$querySelector31 = node.querySelector('isBestBuy')) === null || _node$querySelector31 === void 0 ? void 0 : _node$querySelector31.textContent) || '0'),\n          maxDaysPerTrip: parseInt(((_node$querySelector32 = node.querySelector('maxDaysPerTrip')) === null || _node$querySelector32 === void 0 ? void 0 : _node$querySelector32.textContent) || '0'),\n          isBestBuyText: ((_node$querySelector33 = node.querySelector('isBestBuyText')) === null || _node$querySelector33 === void 0 ? void 0 : _node$querySelector33.textContent) || '',\n          isBestBuyLocation: parseInt(((_node$querySelector34 = node.querySelector('isBestBuyLocation')) === null || _node$querySelector34 === void 0 ? void 0 : _node$querySelector34.textContent) || '0'),\n          numberToSort: parseFloat(((_node$querySelector35 = node.querySelector('numberToSort')) === null || _node$querySelector35 === void 0 ? void 0 : _node$querySelector35.textContent) || '0'),\n          coverLevel: parseInt(((_node$querySelector36 = node.querySelector('coverLevel')) === null || _node$querySelector36 === void 0 ? void 0 : _node$querySelector36.textContent) || '0'),\n          Discount: parseFloat(((_node$querySelector37 = node.querySelector('Discount')) === null || _node$querySelector37 === void 0 ? void 0 : _node$querySelector37.textContent) || '0'),\n          netUW: parseFloat(((_node$querySelector38 = node.querySelector('netUW')) === null || _node$querySelector38 === void 0 ? void 0 : _node$querySelector38.textContent) || '0'),\n          wbComm: parseFloat(((_node$querySelector39 = node.querySelector('wbComm')) === null || _node$querySelector39 === void 0 ? void 0 : _node$querySelector39.textContent) || '0'),\n          agentComm: parseFloat(((_node$querySelector40 = node.querySelector('agentComm')) === null || _node$querySelector40 === void 0 ? void 0 : _node$querySelector40.textContent) || '0'),\n          screeningPremiumPerPersonCSV: ((_node$querySelector41 = node.querySelector('screeningPremiumPerPersonCSV')) === null || _node$querySelector41 === void 0 ? void 0 : _node$querySelector41.textContent) || '',\n          screeningPremiumExcIPTPerPersonCSV: ((_node$querySelector42 = node.querySelector('screeningPremiumExcIPTPerPersonCSV')) === null || _node$querySelector42 === void 0 ? void 0 : _node$querySelector42.textContent) || '',\n          isNotCoveredPerPersonCSV: ((_node$querySelector43 = node.querySelector('isNotCoveredPerPersonCSV')) === null || _node$querySelector43 === void 0 ? void 0 : _node$querySelector43.textContent) || '',\n          policytypeShortName: ((_node$querySelector44 = node.querySelector('policytypeShortName')) === null || _node$querySelector44 === void 0 ? void 0 : _node$querySelector44.textContent) || '',\n          SummaryCovers: []\n        };\n\n        // Parse SummaryCovers\n        const summaryCoversNode = node.querySelector('SummaryCovers');\n        if (summaryCoversNode) {\n          const summaryCoverNodes = summaryCoversNode.querySelectorAll('summaryCover');\n          const summaryCovers = [];\n          summaryCoverNodes.forEach(coverNode => {\n            var _coverNode$querySelec, _coverNode$querySelec2, _coverNode$querySelec3, _coverNode$querySelec4;\n            const rawLimit = ((_coverNode$querySelec = coverNode.querySelector('Limit')) === null || _coverNode$querySelec === void 0 ? void 0 : _coverNode$querySelec.textContent) || '';\n            const rawExcess = ((_coverNode$querySelec2 = coverNode.querySelector('Excess')) === null || _coverNode$querySelec2 === void 0 ? void 0 : _coverNode$querySelec2.textContent) || '';\n            summaryCovers.push({\n              name: ((_coverNode$querySelec3 = coverNode.querySelector('name')) === null || _coverNode$querySelec3 === void 0 ? void 0 : _coverNode$querySelec3.textContent) || '',\n              Limit: formatCurrencyLimit(rawLimit),\n              Excess: formatCurrencyLimit(rawExcess),\n              position: parseInt(((_coverNode$querySelec4 = coverNode.querySelector('position')) === null || _coverNode$querySelec4 === void 0 ? void 0 : _coverNode$querySelec4.textContent) || '0')\n            });\n          });\n          result.SummaryCovers = summaryCovers;\n        }\n        quoteResults.push(result);\n      });\n      return {\n        Message: message,\n        quoteResults\n      };\n    } catch (error) {\n      console.error('Error parsing quote response:', error);\n      throw new Error(`Failed to parse quote response: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n  static parseScreeningQuestionsResponse(xmlText) {\n    try {\n      var _xmlDoc$querySelector2;\n      const parser = new DOMParser();\n      const xmlDoc = parser.parseFromString(xmlText, 'text/xml');\n      const parseError = xmlDoc.querySelector('parsererror');\n      if (parseError) {\n        throw new Error(`XML parsing error: ${parseError.textContent}`);\n      }\n      const message = ((_xmlDoc$querySelector2 = xmlDoc.querySelector('message')) === null || _xmlDoc$querySelector2 === void 0 ? void 0 : _xmlDoc$querySelector2.textContent) || '';\n      const screeningQuestions = [];\n      const questionNodes = xmlDoc.querySelectorAll('screeningQuestion');\n      questionNodes.forEach(node => {\n        var _node$querySelector45, _node$querySelector46, _node$querySelector47, _node$querySelector48, _node$querySelector49, _node$querySelector50, _node$querySelector51, _node$querySelector52;\n        const question = {\n          questionNumber: parseInt(((_node$querySelector45 = node.querySelector('questionNumber')) === null || _node$querySelector45 === void 0 ? void 0 : _node$querySelector45.textContent) || '0'),\n          question: ((_node$querySelector46 = node.querySelector('Question')) === null || _node$querySelector46 === void 0 ? void 0 : _node$querySelector46.textContent) || '',\n          // Capital Q to match API response\n          yesMessage: ((_node$querySelector47 = node.querySelector('yesMessage')) === null || _node$querySelector47 === void 0 ? void 0 : _node$querySelector47.textContent) || '',\n          noMessage: ((_node$querySelector48 = node.querySelector('noMessage')) === null || _node$querySelector48 === void 0 ? void 0 : _node$querySelector48.textContent) || '',\n          yesAction: ((_node$querySelector49 = node.querySelector('yesAction')) === null || _node$querySelector49 === void 0 ? void 0 : _node$querySelector49.textContent) || '',\n          noAction: ((_node$querySelector50 = node.querySelector('noAction')) === null || _node$querySelector50 === void 0 ? void 0 : _node$querySelector50.textContent) || '',\n          yesActionText: ((_node$querySelector51 = node.querySelector('yesActionText')) === null || _node$querySelector51 === void 0 ? void 0 : _node$querySelector51.textContent) || '',\n          noActionText: ((_node$querySelector52 = node.querySelector('noActionText')) === null || _node$querySelector52 === void 0 ? void 0 : _node$querySelector52.textContent) || ''\n        };\n        screeningQuestions.push(question);\n      });\n      return {\n        Message: message,\n        screeningQuestions\n      };\n    } catch (error) {\n      console.error('Error parsing screening questions response:', error);\n      throw new Error(`Failed to parse screening questions response: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n  static parseSavePolicyResponse(xmlText) {\n    try {\n      const parser = new DOMParser();\n      const xmlDoc = parser.parseFromString(xmlText, 'text/xml');\n      const parseError = xmlDoc.querySelector('parsererror');\n      if (parseError) {\n        throw new Error(`XML parsing error: ${parseError.textContent}`);\n      }\n\n      // Log the full XML for debugging\n      console.log('🔍 Full SavePolicyDetails XML Response:', xmlText);\n\n      // Try different possible XML structures and field names\n      const messageNode = xmlDoc.querySelector('Message, message');\n      const policySavedNode = xmlDoc.querySelector('policySaved, PolicySaved');\n      const policyIDNode = xmlDoc.querySelector('policyID, PolicyID');\n\n      // Try multiple variations for certificate\n      const certificateNode = xmlDoc.querySelector('certificate, Certificate, cert, Cert, CertificateURL, certificateURL');\n      const pwNode = xmlDoc.querySelector('PW, pw, PolicyWording, policyWording');\n      const siNode = xmlDoc.querySelector('SI, si, SummaryInsurance, summaryInsurance, SummaryCover, summaryCover');\n      const kfNode = xmlDoc.querySelector('KF, kf, KeyFacts, keyFacts');\n      const ipidNode = xmlDoc.querySelector('IPID, ipid');\n      const message = (messageNode === null || messageNode === void 0 ? void 0 : messageNode.textContent) || '';\n      const policySavedRaw = (policySavedNode === null || policySavedNode === void 0 ? void 0 : policySavedNode.textContent) || 'No';\n      // Handle both \"Yes\"/\"No\" and \"true\"/\"false\" formats\n      const policySaved = policySavedRaw === 'true' ? 'Yes' : policySavedRaw === 'false' ? 'No' : policySavedRaw;\n      const policyID = (policyIDNode === null || policyIDNode === void 0 ? void 0 : policyIDNode.textContent) || '';\n      const certificate = (certificateNode === null || certificateNode === void 0 ? void 0 : certificateNode.textContent) || '';\n      const pw = (pwNode === null || pwNode === void 0 ? void 0 : pwNode.textContent) || '';\n      const si = (siNode === null || siNode === void 0 ? void 0 : siNode.textContent) || '';\n      const kf = (kfNode === null || kfNode === void 0 ? void 0 : kfNode.textContent) || '';\n      const ipid = (ipidNode === null || ipidNode === void 0 ? void 0 : ipidNode.textContent) || '';\n      console.log('📋 Parsed SavePolicyDetails fields:');\n      console.log('  - Message:', message);\n      console.log('  - policySaved (raw):', policySavedRaw);\n      console.log('  - policySaved (normalized):', policySaved);\n      console.log('  - policyID:', policyID);\n      console.log('  - certificate:', certificate || '⚠️ EMPTY/NOT FOUND');\n      console.log('  - PW:', pw || '⚠️ EMPTY/NOT FOUND');\n      console.log('  - SI:', si || '⚠️ EMPTY/NOT FOUND');\n      console.log('  - KF:', kf || '⚠️ EMPTY/NOT FOUND');\n      console.log('  - IPID:', ipid || '⚠️ EMPTY/NOT FOUND');\n\n      // List all XML nodes for debugging\n      console.log('📋 All XML element names in response:');\n      const allElements = xmlDoc.querySelectorAll('*');\n      const elementNames = Array.from(allElements).map(el => el.tagName);\n      console.log('  Available elements:', Array.from(new Set(elementNames)).join(', '));\n      return {\n        Message: message,\n        policySaved: policySaved,\n        policyID: policyID,\n        certificate: certificate,\n        PW: pw,\n        SI: si,\n        KF: kf,\n        IPID: ipid\n      };\n    } catch (error) {\n      console.error('Error parsing save policy response:', error);\n      throw new Error(`Failed to parse save policy response: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n  static parseProductListResponse(xmlText) {\n    try {\n      var _xmlDoc$querySelector3, _xmlDoc$querySelector4;\n      const parser = new DOMParser();\n      const xmlDoc = parser.parseFromString(xmlText, 'text/xml');\n      const parseError = xmlDoc.querySelector('parsererror');\n      if (parseError) {\n        throw new Error(`XML parsing error: ${parseError.textContent}`);\n      }\n      const message = ((_xmlDoc$querySelector3 = xmlDoc.querySelector('message')) === null || _xmlDoc$querySelector3 === void 0 ? void 0 : _xmlDoc$querySelector3.textContent) || '';\n      const resultID = parseInt(((_xmlDoc$querySelector4 = xmlDoc.querySelector('errorID')) === null || _xmlDoc$querySelector4 === void 0 ? void 0 : _xmlDoc$querySelector4.textContent) || '0');\n      const schemas = [];\n      const schemaNodes = xmlDoc.querySelectorAll('Schema');\n      schemaNodes.forEach(node => {\n        var _node$querySelector53, _node$querySelector54;\n        const schema = {\n          SchemaID: parseInt(((_node$querySelector53 = node.querySelector('SchemaID')) === null || _node$querySelector53 === void 0 ? void 0 : _node$querySelector53.textContent) || '0'),\n          SchemaName: ((_node$querySelector54 = node.querySelector('SchemaName')) === null || _node$querySelector54 === void 0 ? void 0 : _node$querySelector54.textContent) || ''\n        };\n        schemas.push(schema);\n      });\n      return {\n        Message: message,\n        ResultID: resultID,\n        Schemas: schemas\n      };\n    } catch (error) {\n      console.error('Error parsing product list response:', error);\n      throw new Error(`Failed to parse product list response: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n  static parsePolicyTypeResponse(xmlText) {\n    try {\n      var _xmlDoc$querySelector5, _xmlDoc$querySelector6;\n      const parser = new DOMParser();\n      const xmlDoc = parser.parseFromString(xmlText, 'text/xml');\n      const parseError = xmlDoc.querySelector('parsererror');\n      if (parseError) {\n        throw new Error(`XML parsing error: ${parseError.textContent}`);\n      }\n      const message = ((_xmlDoc$querySelector5 = xmlDoc.querySelector('message')) === null || _xmlDoc$querySelector5 === void 0 ? void 0 : _xmlDoc$querySelector5.textContent) || '';\n      const resultID = parseInt(((_xmlDoc$querySelector6 = xmlDoc.querySelector('errorID')) === null || _xmlDoc$querySelector6 === void 0 ? void 0 : _xmlDoc$querySelector6.textContent) || '0');\n      const policyTypes = [];\n      const policyTypeNodes = xmlDoc.querySelectorAll('TypePolicy');\n      policyTypeNodes.forEach(node => {\n        var _node$querySelector55, _node$querySelector56, _node$querySelector57;\n        const policyType = {\n          TypePolicyID: ((_node$querySelector55 = node.querySelector('TypePolicyID')) === null || _node$querySelector55 === void 0 ? void 0 : _node$querySelector55.textContent) || '',\n          TypePolicyName: ((_node$querySelector56 = node.querySelector('Name')) === null || _node$querySelector56 === void 0 ? void 0 : _node$querySelector56.textContent) || '',\n          // Changed from TypePolicyName to Name\n          Description: ((_node$querySelector57 = node.querySelector('IsAnnual')) === null || _node$querySelector57 === void 0 ? void 0 : _node$querySelector57.textContent) === '1' ? 'Annual Policy' : 'Single Trip Policy'\n        };\n        policyTypes.push(policyType);\n      });\n      return {\n        Message: message,\n        ResultID: resultID,\n        PolicyTypes: policyTypes\n      };\n    } catch (error) {\n      console.error('Error parsing policy type response:', error);\n      throw new Error(`Failed to parse policy type response: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n  static parsePolicyTypeDestinationResponse(xmlText) {\n    try {\n      var _xmlDoc$querySelector7, _xmlDoc$querySelector8;\n      const parser = new DOMParser();\n      const xmlDoc = parser.parseFromString(xmlText, 'text/xml');\n      const parseError = xmlDoc.querySelector('parsererror');\n      if (parseError) {\n        throw new Error(`XML parsing error: ${parseError.textContent}`);\n      }\n      const message = ((_xmlDoc$querySelector7 = xmlDoc.querySelector('message')) === null || _xmlDoc$querySelector7 === void 0 ? void 0 : _xmlDoc$querySelector7.textContent) || '';\n      const resultID = parseInt(((_xmlDoc$querySelector8 = xmlDoc.querySelector('errorID')) === null || _xmlDoc$querySelector8 === void 0 ? void 0 : _xmlDoc$querySelector8.textContent) || '0');\n      const policyTypeDestinations = [];\n      const destinationNodes = xmlDoc.querySelectorAll('PolicyTypeDestination');\n      destinationNodes.forEach(node => {\n        var _node$querySelector58, _node$querySelector59, _node$querySelector60;\n        const destination = {\n          TypePolicyDestinationID: ((_node$querySelector58 = node.querySelector('TypePolicyDestinationID')) === null || _node$querySelector58 === void 0 ? void 0 : _node$querySelector58.textContent) || '',\n          Name: ((_node$querySelector59 = node.querySelector('Name')) === null || _node$querySelector59 === void 0 ? void 0 : _node$querySelector59.textContent) || '',\n          PolicyTypeID: ((_node$querySelector60 = node.querySelector('PolicyTypeID')) === null || _node$querySelector60 === void 0 ? void 0 : _node$querySelector60.textContent) || ''\n        };\n        policyTypeDestinations.push(destination);\n      });\n      return {\n        Message: message,\n        ResultID: resultID,\n        PolicyTypeDestinations: policyTypeDestinations\n      };\n    } catch (error) {\n      console.error('Error parsing policy type destination response:', error);\n      throw new Error(`Failed to parse policy type destination response: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n}\n\n/**\n * Main Terracotta Service Class\n */\nexport class TerracottaService {\n  constructor(userID = TERRACOTTA_USER_ID, userCode = TERRACOTTA_USER_CODE) {\n    this.userID = void 0;\n    this.userCode = void 0;\n    this.userID = userID;\n    this.userCode = userCode;\n  }\n  static getInstance(userID, userCode) {\n    if (!TerracottaService.instance) {\n      TerracottaService.instance = new TerracottaService(userID || TERRACOTTA_USER_ID, userCode || TERRACOTTA_USER_CODE);\n    }\n    return TerracottaService.instance;\n  }\n\n  /**\n   * Generic SOAP request method\n   */\n  async makeSOAPRequest(method, requestBody) {\n    const soapEnvelope = SOAPBuilder.createEnvelope(requestBody);\n    console.log('Making SOAP request via proxy to:', `${PROXY_BASE_URL}/${method}`);\n    console.log('SOAP Envelope:', soapEnvelope);\n    try {\n      const response = await fetch(`${PROXY_BASE_URL}/${method}`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'text/xml; charset=utf-8'\n        },\n        body: soapEnvelope\n      });\n      console.log('SOAP Response Status:', response.status, response.statusText);\n      const responseText = await response.text();\n      console.log('SOAP Response Body:', responseText);\n      if (!response.ok) {\n        throw new Error(`SOAP request failed: ${response.status} ${response.statusText}`);\n      }\n      return responseText;\n    } catch (error) {\n      console.error('Proxy request failed:', error);\n      throw new Error(`Failed to connect to Terracotta API via proxy: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Test connection with HelloWorld method\n   */\n  async testConnection() {\n    try {\n      const soapBody = `\n        <HelloWorld xmlns=\"WS-IntegratedQuote\">\n        </HelloWorld>`;\n      const responseText = await this.makeSOAPRequest('HelloWorld', soapBody);\n      console.log('Connection test successful:', responseText);\n      return true;\n    } catch (error) {\n      console.error('Connection test failed:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Get available policy types for a specific schema\n   */\n  async getUserProductTypePolicy(schemaId) {\n    try {\n      const userID = parseInt(this.userID) || parseInt(TERRACOTTA_USER_ID);\n      const userCode = parseInt(this.userCode) || parseInt(TERRACOTTA_USER_CODE);\n      console.log('getUserProductTypePolicy - schemaId:', schemaId, 'userID:', userID, 'userCode:', userCode);\n      const soapBody = `\n        <GetUserProductTypePolicy xmlns=\"WS-IntegratedQuote\">\n          <userID>${userID}</userID>\n          <userCode>${userCode}</userCode>\n          <schemaId>${schemaId}</schemaId>\n        </GetUserProductTypePolicy>`;\n      const responseText = await this.makeSOAPRequest('GetUserProductTypePolicy', soapBody);\n      return XMLParser.parsePolicyTypeResponse(responseText);\n    } catch (error) {\n      console.error('Error in getUserProductTypePolicy:', error);\n      throw new Error(`Failed to get policy types: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Get available destinations for a specific schema\n   */\n  async getUserProductDestination(schemaId) {\n    try {\n      const userID = parseInt(this.userID) || parseInt(TERRACOTTA_USER_ID);\n      const userCode = parseInt(this.userCode) || parseInt(TERRACOTTA_USER_CODE);\n      console.log('getUserProductDestination - schemaId:', schemaId, 'userID:', userID, 'userCode:', userCode);\n      const soapBody = `\n        <GetUserProductDestination xmlns=\"WS-IntegratedQuote\">\n          <userID>${userID}</userID>\n          <userCode>${userCode}</userCode>\n          <schemaId>${schemaId}</schemaId>\n        </GetUserProductDestination>`;\n      const responseText = await this.makeSOAPRequest('GetUserProductDestination', soapBody);\n      return XMLParser.parsePolicyTypeDestinationResponse(responseText);\n    } catch (error) {\n      console.error('Error in getUserProductDestination:', error);\n      throw new Error(`Failed to get policy type destinations: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Get available products for the user\n   */\n  async getUserProductList() {\n    try {\n      const userID = parseInt(this.userID) || parseInt(TERRACOTTA_USER_ID);\n      const userCode = parseInt(this.userCode) || parseInt(TERRACOTTA_USER_CODE);\n      console.log('getUserProductList - userID:', userID, 'userCode:', userCode);\n      console.log('getUserProductList - this.userID:', this.userID, 'this.userCode:', this.userCode);\n      const soapBody = `\n        <GetUserProductList xmlns=\"WS-IntegratedQuote\">\n          <userID>${userID}</userID>\n          <userCode>${userCode}</userCode>\n        </GetUserProductList>`;\n      const responseText = await this.makeSOAPRequest('GetUserProductList', soapBody);\n      return XMLParser.parseProductListResponse(responseText);\n    } catch (error) {\n      console.error('Error in getUserProductList:', error);\n      throw new Error(`Failed to get user product list: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * 1. Request for quotations\n   * Calls the ProvideQuotation method to obtain a list of possible quotes\n   */\n  async provideQuotation(request) {\n    try {\n      console.log('🚀 Building SOAP request for ProvideQuotation...');\n      console.log('📦 Request object:', request);\n      const quoteDetailsXML = SOAPBuilder.buildQuoteDetailsXML(request.quoteDetails);\n      console.log('📄 Quote Details XML:', quoteDetailsXML);\n      const soapBody = `\n        <ProvideQuotation xmlns=\"WS-IntegratedQuote\">\n          <userID>${parseInt(request.userID)}</userID>\n          <userCode>${parseInt(request.userCode)}</userCode>\n          ${quoteDetailsXML}\n        </ProvideQuotation>`;\n      console.log('📤 Complete SOAP Body:', soapBody);\n      console.log('🌐 Sending SOAP request to:', `${PROXY_BASE_URL}/ProvideQuotation`);\n      const responseText = await this.makeSOAPRequest('ProvideQuotation', soapBody);\n      console.log('📥 Raw SOAP Response received');\n      console.log('📄 Response length:', responseText.length, 'characters');\n      console.log('📄 First 500 chars of response:', responseText.substring(0, 500));\n      const parsedResponse = XMLParser.parseQuoteResponse(responseText);\n      console.log('✅ Parsed response:', parsedResponse);\n      return parsedResponse;\n    } catch (error) {\n      console.error('❌ Error in provideQuotation:', error);\n      console.error('❌ Error type:', error instanceof Error ? error.constructor.name : typeof error);\n      console.error('❌ Error message:', error instanceof Error ? error.message : String(error));\n      throw new Error(`Failed to get quotes from Terracotta: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * 3. Obtain Screening Questions\n   * Calls ScreeningQuestions to get screening questions for the selected quote\n   */\n  async getScreeningQuestions(quoteID) {\n    try {\n      var _parsed$screeningQues;\n      console.log('🔄 Building SOAP request for ScreeningQuestions...');\n      console.log('📦 QuoteID:', quoteID);\n      console.log('👤 UserID:', this.userID, 'UserCode:', this.userCode);\n      const soapBody = `\n        <ScreeningQuestions xmlns=\"WS-IntegratedQuote\">\n          <userID>${parseInt(this.userID) || parseInt(TERRACOTTA_USER_ID)}</userID>\n          <userCode>${parseInt(this.userCode) || parseInt(TERRACOTTA_USER_CODE)}</userCode>\n          <quoteID>${quoteID}</quoteID>\n        </ScreeningQuestions>`;\n      console.log('📤 SOAP Body for ScreeningQuestions:', soapBody);\n      const responseText = await this.makeSOAPRequest('ScreeningQuestions', soapBody);\n      console.log('📥 Raw Response from ScreeningQuestions:', responseText.substring(0, 1000));\n      const parsed = XMLParser.parseScreeningQuestionsResponse(responseText);\n      console.log('✅ Parsed Screening Questions Response:', parsed);\n      console.log('📋 Number of questions:', ((_parsed$screeningQues = parsed.screeningQuestions) === null || _parsed$screeningQues === void 0 ? void 0 : _parsed$screeningQues.length) || 0);\n      if (parsed.screeningQuestions && parsed.screeningQuestions.length > 0) {\n        console.log('📝 Questions details:');\n        parsed.screeningQuestions.forEach((q, idx) => {\n          console.log(`  ${idx + 1}. Q${q.questionNumber}: ${q.question}`);\n        });\n      }\n      return parsed;\n    } catch (error) {\n      console.error('❌ Error in getScreeningQuestions:', error);\n      console.error('Error type:', error instanceof Error ? error.constructor.name : typeof error);\n      console.error('Error message:', error instanceof Error ? error.message : String(error));\n      throw new Error(`Failed to get screening questions: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * 2. Update quotes with additional covers\n   * Calls ProvideQuotationWithAlterations to get quotes with specific alterations/add-ons\n   * This method can only be called AFTER obtaining a quote reference from ProvideQuotation\n   */\n  async provideQuotationWithAlterations(request) {\n    try {\n      console.log('🚀 Building SOAP request for ProvideQuotationWithAlterations...');\n      console.log('📦 Request object:', request);\n      const specificQuoteDetailsXML = SOAPBuilder.buildSpecificQuoteDetailsXML(request.specificQuoteDetails);\n      console.log('📄 Specific Quote Details XML:', specificQuoteDetailsXML);\n      const soapBody = `\n        <ProvideQuotationWithAlterations xmlns=\"WS-IntegratedQuote\">\n          <userID>${parseInt(request.userID)}</userID>\n          <userCode>${parseInt(request.userCode)}</userCode>\n          <quoteID>${request.quoteID}</quoteID>\n          ${specificQuoteDetailsXML}\n        </ProvideQuotationWithAlterations>`;\n      console.log('📤 Complete SOAP Body:', soapBody);\n      console.log('🌐 Sending SOAP request to:', `${PROXY_BASE_URL}/ProvideQuotationWithAlterations`);\n      const responseText = await this.makeSOAPRequest('ProvideQuotationWithAlterations', soapBody);\n      console.log('📥 Raw SOAP Response received');\n      console.log('📄 Response length:', responseText.length, 'characters');\n      console.log('📄 First 500 chars of response:', responseText.substring(0, 500));\n      const parsedResponse = XMLParser.parseQuoteResponse(responseText);\n      console.log('✅ Parsed response:', parsedResponse);\n      return parsedResponse;\n    } catch (error) {\n      console.error('❌ Error in provideQuotationWithAlterations:', error);\n      console.error('❌ Error type:', error instanceof Error ? error.constructor.name : typeof error);\n      console.error('❌ Error message:', error instanceof Error ? error.message : String(error));\n      throw new Error(`Failed to get quotes with alterations from Terracotta: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * 3. Save a quote as a Live policy\n   * Calls SavePolicyDetails to convert the quote into a live policy\n   */\n  async savePolicyDetails(request) {\n    try {\n      console.log('🚀 Building SOAP request for SavePolicyDetails...');\n      console.log('📦 Request object:', request);\n      const screeningAnswersXML = SOAPBuilder.buildScreeningAnswersXML(request.screeningQuestionAnswers);\n      const soapBody = `\n        <SavePolicyDetails xmlns=\"WS-IntegratedQuote\">\n          <userID>${parseInt(request.userID)}</userID>\n          <userCode>${parseInt(request.userCode)}</userCode>\n          <quoteID>${request.quoteID}</quoteID>\n          ${screeningAnswersXML}\n          ${request.medicalScreeningReference ? `<medicalScreeningReference>${request.medicalScreeningReference}</medicalScreeningReference>` : '<medicalScreeningReference>string</medicalScreeningReference>'}\n          ${request.useDefaultAnswers !== undefined ? `<useDefaultAnswers>${request.useDefaultAnswers}</useDefaultAnswers>` : '<useDefaultAnswers>1</useDefaultAnswers>'}\n        </SavePolicyDetails>`;\n      console.log('📤 Complete SOAP Body for SavePolicyDetails:', soapBody);\n      console.log('🌐 Sending SOAP request to:', `${PROXY_BASE_URL}/SavePolicyDetails`);\n      const responseText = await this.makeSOAPRequest('SavePolicyDetails', soapBody);\n      console.log('📥 Raw SOAP Response from SavePolicyDetails:', responseText);\n      const parsedResponse = XMLParser.parseSavePolicyResponse(responseText);\n      console.log('✅ Parsed SavePolicyDetails response:', parsedResponse);\n      return parsedResponse;\n    } catch (error) {\n      console.error('❌ Error in savePolicyDetails:', error);\n      throw new Error(`Failed to save policy details: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Utility method to convert frontend data to Terracotta format\n   */\n  static convertToTerracottaFormat(formData, availablePolicyTypes) {\n    var _formData$billingAddr, _formData$contactAddr, _formData$billingAddr2, _formData$contactAddr2, _formData$travelers$, _formData$travelers$2;\n    console.log('Converting form data to Terracotta format:', formData);\n\n    // Convert travelers to Terracotta format using actual user data\n    const travelers = formData.travelers.map((traveler, index) => {\n      // Prioritize date of birth over age for accuracy\n      const dateOfBirth = traveler.dateOfBirth || calculateDateOfBirth(parseInt(traveler.age));\n      const calculatedAge = traveler.dateOfBirth ? calculateAgeFromDateOfBirth(traveler.dateOfBirth) : parseInt(traveler.age);\n      console.log(`Traveler ${index + 1}: DOB=${dateOfBirth}, Age=${calculatedAge}`);\n      return {\n        TravellerNumber: index + 1,\n        Title: traveler.title || 'Mr',\n        // Use actual title from form\n        FirstName: traveler.firstName,\n        LastName: traveler.lastName,\n        DateOfBirth: formatDateForTerracotta(dateOfBirth),\n        Age: calculatedAge,\n        AgebandID: getAgebandID(calculatedAge),\n        TitleID: getTitleID(traveler.title || 'Mr'),\n        minAge: calculatedAge,\n        maxAge: calculatedAge,\n        ScreeningInformation: null\n      };\n    });\n\n    // Convert contact details using actual user data\n    const contactDetails = {\n      Address: ((_formData$billingAddr = formData.billingAddress) === null || _formData$billingAddr === void 0 ? void 0 : _formData$billingAddr.street) || ((_formData$contactAddr = formData.contactAddress) === null || _formData$contactAddr === void 0 ? void 0 : _formData$contactAddr.street) || '123 Main Street',\n      Postcode: ((_formData$billingAddr2 = formData.billingAddress) === null || _formData$billingAddr2 === void 0 ? void 0 : _formData$billingAddr2.postalCode) || ((_formData$contactAddr2 = formData.contactAddress) === null || _formData$contactAddr2 === void 0 ? void 0 : _formData$contactAddr2.postalCode) || '12345',\n      Email: ((_formData$travelers$ = formData.travelers[0]) === null || _formData$travelers$ === void 0 ? void 0 : _formData$travelers$.email) || formData.contactEmail || 'test@example.com',\n      Telephone: ((_formData$travelers$2 = formData.travelers[0]) === null || _formData$travelers$2 === void 0 ? void 0 : _formData$travelers$2.phone) || formData.contactPhone || '+30123456789',\n      VehicleMakeModel: formData.vehicleMakeModel,\n      VehicleLicensePlate: formData.vehicleLicensePlate,\n      VehicleYearManufacture: formData.vehicleYearManufacture\n    };\n\n    // Convert trip details using actual user data\n    const quoteDetails = {\n      ResidenceID: getResidenceID(formData.countryOfResidence),\n      TypePolicyID: getTypePolicyID(formData.tripType, availablePolicyTypes),\n      TypePackageID: '1',\n      // Fixed value as requested (string)\n      Destination: formData.destination || 'Europe',\n      StartDate: formatDateForTerracotta(formData.startDate),\n      EndDate: formatDateForTerracotta(formData.endDate),\n      Travellers: travelers,\n      ContactDetails: contactDetails,\n      includeAnnualQuotes: formData.tripType === 'annual' ? 1 : 0,\n      includeUpsell: 0,\n      // Simplified for now\n      currencyID: 1,\n      // EUR\n      schemaIDFilter: '717' // Use schema 717\n    };\n    console.log('Converted Terracotta request:', quoteDetails);\n\n    // Use fixed values as requested\n    return {\n      userID: '4072',\n      userCode: '111427',\n      quoteDetails\n    };\n  }\n}\n\n/**\n * Utility functions for data conversion\n */\n_TerracottaService = TerracottaService;\nTerracottaService.instance = void 0;\nfunction formatDateForTerracotta(dateString) {\n  if (!dateString) return '';\n\n  // Handle different date formats\n  if (dateString.includes('/')) {\n    // Handle DD/MM/YYYY format\n    const parts = dateString.split('/');\n    if (parts.length === 3) {\n      const [day, month, year] = parts;\n      return `${year}/${month}/${day}`;\n    }\n  }\n\n  // Handle YYYY-MM-DD format\n  if (dateString.includes('-')) {\n    return dateString.replace(/-/g, '/');\n  }\n  return dateString;\n}\nfunction calculateDateOfBirth(age) {\n  const currentYear = new Date().getFullYear();\n  const birthYear = currentYear - age;\n  // Use January 1st as default date\n  return `${birthYear}/01/01`;\n}\nfunction calculateAgeFromDateOfBirth(dateOfBirth) {\n  const birthDate = new Date(dateOfBirth);\n  const today = new Date();\n  let age = today.getFullYear() - birthDate.getFullYear();\n  const monthDiff = today.getMonth() - birthDate.getMonth();\n  if (monthDiff < 0 || monthDiff === 0 && today.getDate() < birthDate.getDate()) {\n    age--;\n  }\n  return Math.max(0, age);\n}\nfunction getResidenceID(country) {\n  // Map countries to Terracotta Residence IDs\n  // Based on Terracotta API - Greece is ResidenceID 24\n  const residenceMap = {\n    'Greece': '24',\n    // Correct ResidenceID for Greece\n    'Austria': '4',\n    'Belgium': '6',\n    'Bulgaria': '10',\n    'Croatia (Hrvatska)': '14',\n    'Czech Republic': '16',\n    'Denmark': '17',\n    'Estonia': '20',\n    'Finland': '21',\n    'France': '22',\n    'Germany': '23',\n    'Hungary': '27',\n    'Iceland': '28',\n    'Italy': '33',\n    'Latvia': '38',\n    'Liechtenstein': '40',\n    'Lithuania': '41',\n    'Luxembourg': '42',\n    'Malta': '93',\n    'Netherlands': '47',\n    'Norway': '49',\n    'Poland': '53',\n    'Portugal': '54',\n    'Republic of Cyprus': '283',\n    'Republic of Ireland': '19',\n    'Romania': '55',\n    'Slovak Republic': '59',\n    'Slovenia': '60',\n    'Spain': '62',\n    'Sweden': '63'\n  };\n  return residenceMap[country] || '24'; // Default to Greece\n}\nfunction getTypePolicyID(tripType, availablePolicyTypes) {\n  // If we have SOAP data, use it to find the correct TypePolicyID\n  if (availablePolicyTypes && availablePolicyTypes.length > 0) {\n    const policyType = availablePolicyTypes.find(pt => {\n      const name = pt.TypePolicyName.toLowerCase();\n      switch (tripType) {\n        case 'single':\n          return name.includes('single') && !name.includes('annual');\n        case 'annual':\n          return name.includes('annual') || name.includes('multi-trip');\n        case 'longstay':\n          return name.includes('longstay') || name.includes('long stay');\n        case 'comprehensive':\n          return name.includes('comprehensive');\n        default:\n          return false;\n      }\n    });\n    if (policyType) {\n      console.log(`✅ Found TypePolicyID ${policyType.TypePolicyID} for trip type '${tripType}' (${policyType.TypePolicyName})`);\n      return policyType.TypePolicyID;\n    }\n  }\n\n  // Fallback to hardcoded mappings if SOAP data not available\n  console.log(`⚠️ Using fallback mapping for trip type '${tripType}'`);\n  const policyMap = {\n    'single': '2',\n    // Single Trip TypePolicyID\n    'annual': '23',\n    // Annual Multi-Trip TypePolicyID\n    'longstay': '3',\n    // Longstay TypePolicyID\n    'comprehensive': '2' // Use Single Trip as default\n  };\n  return policyMap[tripType] || '2'; // Default to Single Trip TypePolicyID\n}\nfunction getTypePackageID(tripType) {\n  // Use correct Package IDs (not SchemaIDs)\n  // Package IDs are typically 1, 2, 3, etc. for different coverage levels\n  const packageMap = {\n    'single': '1',\n    // Basic package for single trip\n    'annual': '1',\n    // Basic package for annual\n    'comprehensive': '2' // Higher coverage package\n  };\n  return packageMap[tripType] || '1'; // Default to basic package\n}\nfunction getAgebandID(age) {\n  // Map age to Terracotta Ageband ID\n  if (age <= 17) return 1;\n  if (age <= 30) return 2;\n  if (age <= 40) return 3;\n  if (age <= 50) return 4;\n  if (age <= 60) return 5;\n  if (age <= 70) return 6;\n  return 7; // 70+\n}\nfunction getTitleID(title) {\n  // Map title to Terracotta Title ID\n  const titleMap = {\n    'Mr': 1,\n    'Mrs': 2,\n    'Miss': 3,\n    'Ms': 4,\n    'Dr': 5,\n    'Prof': 6\n  };\n  return titleMap[title] || 1; // Default to Mr\n}\nfunction getCurrencyID(currency) {\n  // Map currency to Terracotta Currency ID\n  const currencyMap = {\n    'EUR': 1,\n    'USD': 2,\n    'GBP': 3,\n    'CHF': 4\n  };\n  return currencyMap[currency] || 1; // Default to EUR\n}\nexport default TerracottaService;","map":{"version":3,"names":["DOMParser","window","XMDOMParser","require","TERRACOTTA_BASE_URL","PROXY_BASE_URL","TERRACOTTA_USER_ID","TERRACOTTA_USER_CODE","formatCurrencyLimit","htmlString","textarea","document","createElement","innerHTML","decoded","value","replace","match","currency","number","formattedNumber","parseInt","toLocaleString","SOAPBuilder","createEnvelope","body","buildTravelerXML","traveler","TravellerNumber","Title","FirstName","LastName","DateOfBirth","Age","AgebandID","TitleID","minAge","maxAge","AlterationID","msPrice","msPriceExcIPT","msConditions","buildContactDetailsXML","contact","Address","Postcode","Email","Telephone","VehicleMakeModel","VehicleLicensePlate","VehicleYearManufacture","buildQuoteDetailsXML","details","travelersXML","Travellers","map","join","contactXML","ContactDetails","ResidenceID","TypePolicyID","TypePackageID","Destination","StartDate","EndDate","includeAnnualQuotes","undefined","includeUpsell","currencyID","schemaIDFilter","buildScreeningAnswersXML","answers","answer","questionNumber","buildEligibilityAnswersXML","buildDynamicDetailsXML","detail","Position","FieldName","FieldValue","FieldSize","buildSpecificQuoteDetailsXML","dynamicDetailsXML","DynamicDetails","screeningAnswersXML","screeningQuestionAnswers","eligibilityAnswersXML","EligibilityQuestionAnswers","XMLParser","getXMLParser","parseQuoteResponse","xmlText","_xmlDoc$querySelector","parser","xmlDoc","parseFromString","parseError","querySelector","Error","textContent","message","quoteResults","quoteResultNodes","querySelectorAll","length","console","log","forEach","node","_node$querySelector","_node$querySelector2","_node$querySelector3","_node$querySelector4","_node$querySelector5","_node$querySelector6","_node$querySelector7","_node$querySelector8","_node$querySelector9","_node$querySelector0","_node$querySelector1","_node$querySelector10","_node$querySelector11","_node$querySelector12","_node$querySelector13","_node$querySelector14","_node$querySelector15","_node$querySelector16","_node$querySelector17","_node$querySelector18","_node$querySelector19","_node$querySelector20","_node$querySelector21","_node$querySelector22","_node$querySelector23","_node$querySelector24","_node$querySelector25","_node$querySelector26","_node$querySelector27","_node$querySelector28","_node$querySelector29","_node$querySelector30","_node$querySelector31","_node$querySelector32","_node$querySelector33","_node$querySelector34","_node$querySelector35","_node$querySelector36","_node$querySelector37","_node$querySelector38","_node$querySelector39","_node$querySelector40","_node$querySelector41","_node$querySelector42","_node$querySelector43","_node$querySelector44","quoteID","result","QuoteID","schemaName","policytypeName","residenceName","destinationName","startDate","endDate","SI","PW","KF","HelpFile","IPT","parseFloat","IPTRate","GrossPrice","screeningPremium","IconURL","SchemaID","PolicyTypeID","DestinationID","PackageID","MaxAgeAgebandID","ScreeningID","groupPerProduct","priceOrder","IPID","typePolicyName","typePackageName","currencyHTMLEncoded","packageName","isAnnual","isBestBuy","maxDaysPerTrip","isBestBuyText","isBestBuyLocation","numberToSort","coverLevel","Discount","netUW","wbComm","agentComm","screeningPremiumPerPersonCSV","screeningPremiumExcIPTPerPersonCSV","isNotCoveredPerPersonCSV","policytypeShortName","SummaryCovers","summaryCoversNode","summaryCoverNodes","summaryCovers","coverNode","_coverNode$querySelec","_coverNode$querySelec2","_coverNode$querySelec3","_coverNode$querySelec4","rawLimit","rawExcess","push","name","Limit","Excess","position","Message","error","parseScreeningQuestionsResponse","_xmlDoc$querySelector2","screeningQuestions","questionNodes","_node$querySelector45","_node$querySelector46","_node$querySelector47","_node$querySelector48","_node$querySelector49","_node$querySelector50","_node$querySelector51","_node$querySelector52","question","yesMessage","noMessage","yesAction","noAction","yesActionText","noActionText","parseSavePolicyResponse","messageNode","policySavedNode","policyIDNode","certificateNode","pwNode","siNode","kfNode","ipidNode","policySavedRaw","policySaved","policyID","certificate","pw","si","kf","ipid","allElements","elementNames","Array","from","el","tagName","Set","parseProductListResponse","_xmlDoc$querySelector3","_xmlDoc$querySelector4","resultID","schemas","schemaNodes","_node$querySelector53","_node$querySelector54","schema","SchemaName","ResultID","Schemas","parsePolicyTypeResponse","_xmlDoc$querySelector5","_xmlDoc$querySelector6","policyTypes","policyTypeNodes","_node$querySelector55","_node$querySelector56","_node$querySelector57","policyType","TypePolicyName","Description","PolicyTypes","parsePolicyTypeDestinationResponse","_xmlDoc$querySelector7","_xmlDoc$querySelector8","policyTypeDestinations","destinationNodes","_node$querySelector58","_node$querySelector59","_node$querySelector60","destination","TypePolicyDestinationID","Name","PolicyTypeDestinations","TerracottaService","constructor","userID","userCode","getInstance","instance","makeSOAPRequest","method","requestBody","soapEnvelope","response","fetch","headers","status","statusText","responseText","text","ok","testConnection","soapBody","getUserProductTypePolicy","schemaId","getUserProductDestination","getUserProductList","provideQuotation","request","quoteDetailsXML","quoteDetails","substring","parsedResponse","String","getScreeningQuestions","_parsed$screeningQues","parsed","q","idx","provideQuotationWithAlterations","specificQuoteDetailsXML","specificQuoteDetails","savePolicyDetails","medicalScreeningReference","useDefaultAnswers","convertToTerracottaFormat","formData","availablePolicyTypes","_formData$billingAddr","_formData$contactAddr","_formData$billingAddr2","_formData$contactAddr2","_formData$travelers$","_formData$travelers$2","travelers","index","dateOfBirth","calculateDateOfBirth","age","calculatedAge","calculateAgeFromDateOfBirth","title","firstName","lastName","formatDateForTerracotta","getAgebandID","getTitleID","ScreeningInformation","contactDetails","billingAddress","street","contactAddress","postalCode","email","contactEmail","phone","contactPhone","vehicleMakeModel","vehicleLicensePlate","vehicleYearManufacture","getResidenceID","countryOfResidence","getTypePolicyID","tripType","_TerracottaService","dateString","includes","parts","split","day","month","year","currentYear","Date","getFullYear","birthYear","birthDate","today","monthDiff","getMonth","getDate","Math","max","country","residenceMap","find","pt","toLowerCase","policyMap","getTypePackageID","packageMap","titleMap","getCurrencyID","currencyMap"],"sources":["C:/Users/laptop-123/TravelInsurance_Demo_2/src/services/terracottaService.ts"],"sourcesContent":["/**\n * Terracotta Insurance Quote Integration Service\n * \n * This service handles all communication with the Terracotta Integrated Quote web service\n * using SOAP protocol. It provides methods for:\n * - Requesting quotes (ProvideQuotation)\n * - Updating quotes with additional covers (ProvideQuotationWithAlterations)\n * - Getting screening questions (ScreeningQuestions)\n * - Saving policy details (SavePolicyDetails)\n */\n\n// Import xmldom for Node.js XML parsing\nlet DOMParser: any;\nif (typeof window === 'undefined') {\n  // Node.js environment\n  const { DOMParser: XMDOMParser } = require('xmldom');\n  DOMParser = XMDOMParser;\n} else {\n  // Browser environment\n  DOMParser = window.DOMParser;\n}\n\n// Terracotta API Configuration\nconst TERRACOTTA_BASE_URL = 'https://www.asuaonline.com/ws/integratedquote.asmx';\nconst PROXY_BASE_URL = 'http://localhost:3001/api/terracotta';\nconst TERRACOTTA_USER_ID = '4072';\nconst TERRACOTTA_USER_CODE = '111427';\n\n// TypeScript interfaces for Terracotta API data structures\n\nexport interface TerracottaPolicyType {\n  TypePolicyID: string;\n  TypePolicyName: string;\n  Description?: string;\n}\n\nexport interface TerracottaPolicyTypeDestination {\n  TypePolicyDestinationID: string;\n  Name: string;\n  PolicyTypeID?: string;\n}\n\nexport interface TerracottaPolicyTypeDestinationResponse {\n  Message: string;\n  ResultID: number;\n  PolicyTypeDestinations: TerracottaPolicyTypeDestination[];\n}\n\nexport interface TerracottaPolicyTypeResponse {\n  Message: string;\n  ResultID: number;\n  PolicyTypes: TerracottaPolicyType[];\n}\n\nexport interface TerracottaTraveler {\n  TravellerNumber: number;\n  Title: string;\n  FirstName: string;\n  LastName: string;\n  DateOfBirth: string; // Format: YYYY/MM/DD\n  Age: number;\n  AgebandID?: number;\n  TitleID?: number;\n  minAge?: number;\n  maxAge?: number;\n  AlterationID?: string;\n  msPrice?: number;\n  msPriceExcIPT?: number;\n  msConditions?: string;\n  ScreeningInformation?: any;\n}\n\nexport interface TerracottaContactDetails {\n  Address: string;\n  Postcode: string;\n  Email: string;\n  Telephone: string;\n  VehicleMakeModel?: string;\n  VehicleLicensePlate?: string;\n  VehicleYearManufacture?: string;\n}\n\nexport interface TerracottaQuoteDetails {\n  ResidenceID: string;\n  TypePolicyID: string; // Comma-separated list of policy type IDs\n  TypePackageID: string;\n  Destination: string;\n  StartDate: string; // Format: YYYY/MM/DD\n  EndDate: string; // Format: YYYY/MM/DD\n  Travellers: TerracottaTraveler[];\n  ContactDetails: TerracottaContactDetails;\n  includeAnnualQuotes?: number;\n  includeUpsell?: number;\n  alterionGenericID?: string;\n  voucherCode?: string;\n  isCYTI?: boolean;\n  currencyID?: number;\n  groupPerProduct?: boolean;\n  priceOrder?: number;\n  schemaIDFilter?: string;\n  useCoverLevelUpsell?: boolean;\n  sellOnBehalfOf?: number;\n  customerUniqueID?: number;\n  quoteVisitAuditID?: number;\n}\n\nexport interface TerracottaQuoteRequest {\n  userID: string;\n  userCode: string;\n  quoteDetails: TerracottaQuoteDetails;\n}\n\nexport interface TerracottaDynamicDetail {\n  Position: number;\n  FieldName: string;\n  FieldValue: string;\n  FieldSize: number;\n}\n\nexport interface TerracottaEligibilityQuestionAnswer {\n  questionNumber: number;\n  answer: 'yes' | 'no';\n}\n\nexport interface TerracottaQuoteWithAlterationsRequest {\n  userID: string;\n  userCode: string;\n  quoteID: string; // Note: lowercase 'q' as per documentation\n  specificQuoteDetails: {\n    AlterationID: string; // Comma-separated list of alteration IDs\n    Travellers: TerracottaTraveler[];\n    ContactDetails: TerracottaContactDetails;\n    DynamicDetails?: TerracottaDynamicDetail[];\n    screeningQuestionAnswers?: TerracottaScreeningQuestionAnswer[];\n    EligibilityQuestionAnswers?: TerracottaEligibilityQuestionAnswer[];\n  };\n}\n\nexport interface SummaryCover {\n  name: string;\n  Limit: string;\n  Excess: string;\n  position?: number;\n}\n\nexport interface TerracottaQuoteResult {\n  QuoteID: string;\n  schemaName: string;\n  policytypeName: string;\n  residenceName: string;\n  destinationName: string;\n  startDate: string;\n  endDate: string;\n  SI: string; // Summary of cover PDF URL\n  PW: string; // Policy wording PDF URL\n  KF: string;\n  HelpFile: string;\n  currency: string;\n  IPT: number; // IPT amount\n  IPTRate: number;\n  GrossPrice: number; // Quote price\n  screeningPremium: number;\n  IconURL: string;\n  SchemaID: number;\n  PolicyTypeID: number;\n  DestinationID: number;\n  PackageID: number;\n  MaxAgeAgebandID: number;\n  ScreeningID: number;\n  groupPerProduct: boolean;\n  priceOrder: number;\n  IPID: string;\n  typePolicyName: string;\n  typePackageName: string;\n  currencyHTMLEncoded: string;\n  AlterationID: string;\n  packageName: string;\n  isAnnual: number;\n  isBestBuy: number;\n  maxDaysPerTrip: number;\n  isBestBuyText: string;\n  isBestBuyLocation: number;\n  numberToSort: number;\n  coverLevel: number;\n  Discount: number;\n  netUW: number;\n  wbComm: number;\n  agentComm: number;\n  screeningPremiumPerPersonCSV: string;\n  screeningPremiumExcIPTPerPersonCSV: string;\n  isNotCoveredPerPersonCSV: string;\n  policytypeShortName: string;\n  SummaryCovers?: SummaryCover[];\n}\n\nexport interface TerracottaQuoteResponse {\n  Message: string;\n  quoteResults: TerracottaQuoteResult[];\n}\n\nexport interface TerracottaScreeningQuestionAnswer {\n  questionNumber: number;\n  answer: 'yes' | 'no';\n}\n\nexport interface TerracottaSavePolicyRequest {\n  userID: string;\n  userCode: string;\n  quoteID: string;\n  screeningQuestionAnswers: TerracottaScreeningQuestionAnswer[];\n  medicalScreeningReference?: string;\n  useDefaultAnswers?: number;\n}\n\nexport interface TerracottaSavePolicyResponse {\n  Message: string;\n  policySaved: 'Yes' | 'No' | 'true' | 'false';\n  policyID: string;\n  certificate: string; // URL for policy certificate\n  PW: string; // Policy wording PDF URL\n  SI: string; // Summary of cover PDF URL\n  KF?: string; // Key Facts PDF URL\n  IPID?: string; // Insurance Product Information Document URL\n}\n\nexport interface TerracottaScreeningQuestion {\n  questionNumber: number;\n  question: string;\n  yesMessage: string;\n  noMessage: string;\n  yesAction: string;\n  noAction: string;\n  yesActionText: string;\n  noActionText: string;\n}\n\nexport interface TerracottaScreeningQuestionsResponse {\n  Message: string;\n  screeningQuestions: TerracottaScreeningQuestion[];\n}\n\nexport interface TerracottaProduct {\n  SchemaID: number;\n  SchemaName: string;\n}\n\nexport interface TerracottaProductListResponse {\n  Message: string;\n  ResultID: number;\n  Schemas: TerracottaProduct[];\n}\n\n/**\n * Helper function to decode HTML entities and format currency\n */\nfunction formatCurrencyLimit(htmlString: string): string {\n  if (!htmlString) return '';\n  \n  // Decode HTML entities\n  const textarea = document.createElement('textarea');\n  textarea.innerHTML = htmlString;\n  let decoded = textarea.value;\n  \n  // Additional manual replacements for common entities\n  decoded = decoded\n    .replace(/&euro;/gi, '€')\n    .replace(/&pound;/gi, '£')\n    .replace(/&dollar;/gi, '$')\n    .replace(/&amp;/gi, '&')\n    .replace(/&lt;/gi, '<')\n    .replace(/&gt;/gi, '>')\n    .replace(/&quot;/gi, '\"')\n    .replace(/&#39;/gi, \"'\");\n  \n  // Format numbers with thousand separators\n  // Match patterns like €32000 or euro32000 and add commas\n  decoded = decoded.replace(/([€£$]|euro|pound|dollar)?\\s*(\\d{4,})/gi, (match, currency, number) => {\n    const formattedNumber = parseInt(number).toLocaleString('en-US');\n    return currency ? `${currency}${formattedNumber}` : formattedNumber;\n  });\n  \n  // Fix spacing: \"Up to€32,000\" -> \"Up to €32,000\"\n  decoded = decoded.replace(/(\\w)([€£$])/g, '$1 $2');\n  \n  return decoded;\n}\n\n/**\n * SOAP XML Builder utility functions\n */\nclass SOAPBuilder {\n  static createEnvelope(body: string): string {\n    return `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<soap:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" \n               xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" \n               xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\">\n  <soap:Body>\n    ${body}\n  </soap:Body>\n</soap:Envelope>`;\n  }\n\n  static buildTravelerXML(traveler: TerracottaTraveler): string {\n    return `\n      <Traveller>\n        <TravellerNumber>${traveler.TravellerNumber}</TravellerNumber>\n        <Title>${traveler.Title}</Title>\n        <FirstName>${traveler.FirstName}</FirstName>\n        <LastName>${traveler.LastName}</LastName>\n        <DateOfBirth>${traveler.DateOfBirth}</DateOfBirth>\n        <Age>${traveler.Age}</Age>\n        <AgebandID>${traveler.AgebandID || 0}</AgebandID>\n        <TitleID>${traveler.TitleID || 0}</TitleID>\n        <minAge>${traveler.minAge || traveler.Age}</minAge>\n        <maxAge>${traveler.maxAge || traveler.Age}</maxAge>\n        <AlterationID>${traveler.AlterationID || ''}</AlterationID>\n        <msPrice>${traveler.msPrice || 0}</msPrice>\n        <msPriceExcIPT>${traveler.msPriceExcIPT || 0}</msPriceExcIPT>\n        <msConditions>${traveler.msConditions || ''}</msConditions>\n        <ScreeningInformation xsi:nil=\"true\" />\n      </Traveller>`;\n  }\n\n  static buildContactDetailsXML(contact: TerracottaContactDetails): string {\n    return `\n      <ContactDetails>\n        <Address>${contact.Address}</Address>\n        <Postcode>${contact.Postcode}</Postcode>\n        <Email>${contact.Email}</Email>\n        <Telephone>${contact.Telephone}</Telephone>\n        ${contact.VehicleMakeModel ? `<VehicleMakeModel>${contact.VehicleMakeModel}</VehicleMakeModel>` : ''}\n        ${contact.VehicleLicensePlate ? `<VehicleLicensePlate>${contact.VehicleLicensePlate}</VehicleLicensePlate>` : ''}\n        ${contact.VehicleYearManufacture ? `<VehicleYearManufacture>${contact.VehicleYearManufacture}</VehicleYearManufacture>` : ''}\n      </ContactDetails>`;\n  }\n\n  static buildQuoteDetailsXML(details: TerracottaQuoteDetails): string {\n    const travelersXML = details.Travellers.map(traveler => \n      this.buildTravelerXML(traveler)\n    ).join('');\n\n    const contactXML = this.buildContactDetailsXML(details.ContactDetails);\n\n    return `\n      <quoteDetails>\n        <ResidenceID>${parseInt(details.ResidenceID) || 1}</ResidenceID>\n        <TypePolicyID>${details.TypePolicyID}</TypePolicyID>\n        <TypePackageID>${parseInt(details.TypePackageID) || 1}</TypePackageID>\n        <Destination>${details.Destination}</Destination>\n        <StartDate>${details.StartDate}</StartDate>\n        <EndDate>${details.EndDate}</EndDate>\n        <Travellers>\n          ${travelersXML}\n        </Travellers>\n        ${contactXML}\n        ${details.includeAnnualQuotes !== undefined ? `<includeAnnualQuotes>${details.includeAnnualQuotes}</includeAnnualQuotes>` : ''}\n        ${details.includeUpsell !== undefined ? `<includeUpsell>${details.includeUpsell}</includeUpsell>` : ''}\n        ${details.currencyID ? `<currencyID>${details.currencyID}</currencyID>` : ''}\n        ${details.schemaIDFilter ? `<schemaIDFilter>${details.schemaIDFilter}</schemaIDFilter>` : ''}\n      </quoteDetails>`;\n  }\n\n  static buildScreeningAnswersXML(answers: TerracottaScreeningQuestionAnswer[]): string {\n    return '<screeningQuestionAnswers>' + \n      answers.map(answer => `\n        <screeningQuestionAnswer>\n          <questionNumber>${answer.questionNumber}</questionNumber>\n          <answer>${answer.answer}</answer>\n        </screeningQuestionAnswer>`\n      ).join('') + '</screeningQuestionAnswers>';\n  }\n\n  static buildEligibilityAnswersXML(answers: TerracottaEligibilityQuestionAnswer[]): string {\n    return '<EligibilityQuestionAnswers>' + \n      answers.map(answer => `\n        <eligibilityQuestionAnswer>\n          <questionNumber>${answer.questionNumber}</questionNumber>\n          <answer>${answer.answer}</answer>\n        </eligibilityQuestionAnswer>`\n      ).join('') + '</EligibilityQuestionAnswers>';\n  }\n\n  static buildDynamicDetailsXML(details: TerracottaDynamicDetail[]): string {\n    return '<DynamicDetails>' + \n      details.map(detail => `\n        <DynamicDetail_SavedValue>\n          <Position>${detail.Position}</Position>\n          <FieldName>${detail.FieldName}</FieldName>\n          <FieldValue>${detail.FieldValue}</FieldValue>\n          <FieldSize>${detail.FieldSize}</FieldSize>\n        </DynamicDetail_SavedValue>`\n      ).join('') + '</DynamicDetails>';\n  }\n\n  static buildSpecificQuoteDetailsXML(details: any): string {\n    const travelersXML = details.Travellers.map((traveler: TerracottaTraveler) => \n      this.buildTravelerXML(traveler)\n    ).join('');\n\n    const contactXML = this.buildContactDetailsXML(details.ContactDetails);\n    \n    const dynamicDetailsXML = details.DynamicDetails ? \n      this.buildDynamicDetailsXML(details.DynamicDetails) : '';\n    \n    const screeningAnswersXML = details.screeningQuestionAnswers ? \n      this.buildScreeningAnswersXML(details.screeningQuestionAnswers) : '';\n    \n    const eligibilityAnswersXML = details.EligibilityQuestionAnswers ? \n      this.buildEligibilityAnswersXML(details.EligibilityQuestionAnswers) : '';\n\n    return `\n      <specificQuoteDetails>\n        <AlterationID>${details.AlterationID}</AlterationID>\n        <Travellers>\n          ${travelersXML}\n        </Travellers>\n        ${contactXML}\n        ${dynamicDetailsXML}\n        ${screeningAnswersXML}\n        ${eligibilityAnswersXML}\n      </specificQuoteDetails>`;\n  }\n}\n\n/**\n * XML Parser utility functions\n */\nclass XMLParser {\n  static getXMLParser(): any {\n    return new DOMParser();\n  }\n\n\n  static parseQuoteResponse(xmlText: string): TerracottaQuoteResponse {\n    try {\n      const parser = new DOMParser();\n      const xmlDoc = parser.parseFromString(xmlText, 'text/xml');\n      \n      // Check for parsing errors\n      const parseError = xmlDoc.querySelector('parsererror');\n      if (parseError) {\n        throw new Error(`XML parsing error: ${parseError.textContent}`);\n      }\n\n      const message = xmlDoc.querySelector('message')?.textContent || '';\n      const quoteResults: TerracottaQuoteResult[] = [];\n\n      // Select only child quoteResults, not the parent container\n      // Handle both ProvideQuotation and ProvideQuotationWithAlterations responses\n      let quoteResultNodes = xmlDoc.querySelectorAll('ProvideQuotationResult > quoteResults > quoteResults');\n      \n      // If not found, try ProvideQuotationWithAlterationsResult\n      if (quoteResultNodes.length === 0) {\n        quoteResultNodes = xmlDoc.querySelectorAll('ProvideQuotationWithAlterationsResult > quoteResults > quoteResults');\n      }\n      \n      // If still not found, try without the parent Result element\n      if (quoteResultNodes.length === 0) {\n        quoteResultNodes = xmlDoc.querySelectorAll('quoteResults > quoteResults');\n      }\n      \n      console.log(`📊 Found ${quoteResultNodes.length} quote result nodes in XML`);\n      \n      quoteResultNodes.forEach((node: any) => {\n        // Only process nodes that have QuoteID (skip empty parent nodes)\n        const quoteID = node.querySelector('QuoteID')?.textContent || '';\n        if (!quoteID) {\n          console.log('⚠️ Skipping node without QuoteID');\n          return; // Skip empty nodes\n        }\n        console.log(`✅ Processing quote result with QuoteID: ${quoteID}`);\n        \n        const result: TerracottaQuoteResult = {\n          QuoteID: quoteID,\n          schemaName: node.querySelector('schemaName')?.textContent || '',\n          policytypeName: node.querySelector('policytypeName')?.textContent || '',\n          residenceName: node.querySelector('residenceName')?.textContent || '',\n          destinationName: node.querySelector('destinationName')?.textContent || '',\n          startDate: node.querySelector('startDate')?.textContent || '',\n          endDate: node.querySelector('endDate')?.textContent || '',\n          SI: node.querySelector('SI')?.textContent || '',\n          PW: node.querySelector('PW')?.textContent || '',\n          KF: node.querySelector('KF')?.textContent || '',\n          HelpFile: node.querySelector('HelpFile')?.textContent || '',\n          currency: node.querySelector('currency')?.textContent || '',\n          IPT: parseFloat(node.querySelector('IPT')?.textContent || '0'),\n          IPTRate: parseFloat(node.querySelector('IPTRate')?.textContent || '0'),\n          GrossPrice: parseFloat(node.querySelector('GrossPrice')?.textContent || '0'),\n          screeningPremium: parseFloat(node.querySelector('screeningPremium')?.textContent || '0'),\n          IconURL: node.querySelector('IconURL')?.textContent || '',\n          SchemaID: parseInt(node.querySelector('SchemaID')?.textContent || '0'),\n          PolicyTypeID: parseInt(node.querySelector('PolicyTypeID')?.textContent || '0'),\n          DestinationID: parseInt(node.querySelector('DestinationID')?.textContent || '0'),\n          PackageID: parseInt(node.querySelector('PackageID')?.textContent || '0'),\n          MaxAgeAgebandID: parseInt(node.querySelector('MaxAgeAgebandID')?.textContent || '0'),\n          ScreeningID: parseInt(node.querySelector('ScreeningID')?.textContent || '0'),\n          groupPerProduct: node.querySelector('groupPerProduct')?.textContent === 'true',\n          priceOrder: parseInt(node.querySelector('priceOrder')?.textContent || '0'),\n          IPID: node.querySelector('IPID')?.textContent || '',\n          typePolicyName: node.querySelector('typePolicyName')?.textContent || '',\n          typePackageName: node.querySelector('typePackageName')?.textContent || '',\n          currencyHTMLEncoded: node.querySelector('currencyHTMLEncoded')?.textContent || '',\n          AlterationID: node.querySelector('AlterationID')?.textContent || '',\n          packageName: node.querySelector('packageName')?.textContent || '',\n          isAnnual: parseInt(node.querySelector('isAnnual')?.textContent || '0'),\n          isBestBuy: parseInt(node.querySelector('isBestBuy')?.textContent || '0'),\n          maxDaysPerTrip: parseInt(node.querySelector('maxDaysPerTrip')?.textContent || '0'),\n          isBestBuyText: node.querySelector('isBestBuyText')?.textContent || '',\n          isBestBuyLocation: parseInt(node.querySelector('isBestBuyLocation')?.textContent || '0'),\n          numberToSort: parseFloat(node.querySelector('numberToSort')?.textContent || '0'),\n          coverLevel: parseInt(node.querySelector('coverLevel')?.textContent || '0'),\n          Discount: parseFloat(node.querySelector('Discount')?.textContent || '0'),\n          netUW: parseFloat(node.querySelector('netUW')?.textContent || '0'),\n          wbComm: parseFloat(node.querySelector('wbComm')?.textContent || '0'),\n          agentComm: parseFloat(node.querySelector('agentComm')?.textContent || '0'),\n          screeningPremiumPerPersonCSV: node.querySelector('screeningPremiumPerPersonCSV')?.textContent || '',\n          screeningPremiumExcIPTPerPersonCSV: node.querySelector('screeningPremiumExcIPTPerPersonCSV')?.textContent || '',\n          isNotCoveredPerPersonCSV: node.querySelector('isNotCoveredPerPersonCSV')?.textContent || '',\n          policytypeShortName: node.querySelector('policytypeShortName')?.textContent || '',\n          SummaryCovers: []\n        };\n        \n        // Parse SummaryCovers\n        const summaryCoversNode = node.querySelector('SummaryCovers');\n        if (summaryCoversNode) {\n          const summaryCoverNodes = summaryCoversNode.querySelectorAll('summaryCover');\n          const summaryCovers: SummaryCover[] = [];\n          summaryCoverNodes.forEach((coverNode: any) => {\n            const rawLimit = coverNode.querySelector('Limit')?.textContent || '';\n            const rawExcess = coverNode.querySelector('Excess')?.textContent || '';\n            \n            summaryCovers.push({\n              name: coverNode.querySelector('name')?.textContent || '',\n              Limit: formatCurrencyLimit(rawLimit),\n              Excess: formatCurrencyLimit(rawExcess),\n              position: parseInt(coverNode.querySelector('position')?.textContent || '0')\n            });\n          });\n          result.SummaryCovers = summaryCovers;\n        }\n        \n        quoteResults.push(result);\n      });\n\n      return { Message: message, quoteResults };\n    } catch (error) {\n      console.error('Error parsing quote response:', error);\n      throw new Error(`Failed to parse quote response: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  static parseScreeningQuestionsResponse(xmlText: string): TerracottaScreeningQuestionsResponse {\n    try {\n      const parser = new DOMParser();\n      const xmlDoc = parser.parseFromString(xmlText, 'text/xml');\n      \n      const parseError = xmlDoc.querySelector('parsererror');\n      if (parseError) {\n        throw new Error(`XML parsing error: ${parseError.textContent}`);\n      }\n\n      const message = xmlDoc.querySelector('message')?.textContent || '';\n      const screeningQuestions: TerracottaScreeningQuestion[] = [];\n\n      const questionNodes = xmlDoc.querySelectorAll('screeningQuestion');\n      questionNodes.forEach((node: any) => {\n        const question: TerracottaScreeningQuestion = {\n          questionNumber: parseInt(node.querySelector('questionNumber')?.textContent || '0'),\n          question: node.querySelector('Question')?.textContent || '',  // Capital Q to match API response\n          yesMessage: node.querySelector('yesMessage')?.textContent || '',\n          noMessage: node.querySelector('noMessage')?.textContent || '',\n          yesAction: node.querySelector('yesAction')?.textContent || '',\n          noAction: node.querySelector('noAction')?.textContent || '',\n          yesActionText: node.querySelector('yesActionText')?.textContent || '',\n          noActionText: node.querySelector('noActionText')?.textContent || ''\n        };\n        screeningQuestions.push(question);\n      });\n\n      return { Message: message, screeningQuestions };\n    } catch (error) {\n      console.error('Error parsing screening questions response:', error);\n      throw new Error(`Failed to parse screening questions response: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  static parseSavePolicyResponse(xmlText: string): TerracottaSavePolicyResponse {\n    try {\n      const parser = new DOMParser();\n      const xmlDoc = parser.parseFromString(xmlText, 'text/xml');\n      \n      const parseError = xmlDoc.querySelector('parsererror');\n      if (parseError) {\n        throw new Error(`XML parsing error: ${parseError.textContent}`);\n      }\n\n      // Log the full XML for debugging\n      console.log('🔍 Full SavePolicyDetails XML Response:', xmlText);\n      \n      // Try different possible XML structures and field names\n      const messageNode = xmlDoc.querySelector('Message, message');\n      const policySavedNode = xmlDoc.querySelector('policySaved, PolicySaved');\n      const policyIDNode = xmlDoc.querySelector('policyID, PolicyID');\n      \n      // Try multiple variations for certificate\n      const certificateNode = xmlDoc.querySelector('certificate, Certificate, cert, Cert, CertificateURL, certificateURL');\n      const pwNode = xmlDoc.querySelector('PW, pw, PolicyWording, policyWording');\n      const siNode = xmlDoc.querySelector('SI, si, SummaryInsurance, summaryInsurance, SummaryCover, summaryCover');\n      const kfNode = xmlDoc.querySelector('KF, kf, KeyFacts, keyFacts');\n      const ipidNode = xmlDoc.querySelector('IPID, ipid');\n      \n      const message = messageNode?.textContent || '';\n      const policySavedRaw = policySavedNode?.textContent || 'No';\n      // Handle both \"Yes\"/\"No\" and \"true\"/\"false\" formats\n      const policySaved = (policySavedRaw === 'true' ? 'Yes' : policySavedRaw === 'false' ? 'No' : policySavedRaw) as 'Yes' | 'No' | 'true' | 'false';\n      const policyID = policyIDNode?.textContent || '';\n      const certificate = certificateNode?.textContent || '';\n      const pw = pwNode?.textContent || '';\n      const si = siNode?.textContent || '';\n      const kf = kfNode?.textContent || '';\n      const ipid = ipidNode?.textContent || '';\n      \n      console.log('📋 Parsed SavePolicyDetails fields:');\n      console.log('  - Message:', message);\n      console.log('  - policySaved (raw):', policySavedRaw);\n      console.log('  - policySaved (normalized):', policySaved);\n      console.log('  - policyID:', policyID);\n      console.log('  - certificate:', certificate || '⚠️ EMPTY/NOT FOUND');\n      console.log('  - PW:', pw || '⚠️ EMPTY/NOT FOUND');\n      console.log('  - SI:', si || '⚠️ EMPTY/NOT FOUND');\n      console.log('  - KF:', kf || '⚠️ EMPTY/NOT FOUND');\n      console.log('  - IPID:', ipid || '⚠️ EMPTY/NOT FOUND');\n      \n      // List all XML nodes for debugging\n      console.log('📋 All XML element names in response:');\n      const allElements = xmlDoc.querySelectorAll('*');\n      const elementNames = Array.from(allElements as NodeListOf<Element>).map(el => el.tagName);\n      console.log('  Available elements:', Array.from(new Set(elementNames)).join(', '));\n\n      return {\n        Message: message,\n        policySaved: policySaved,\n        policyID: policyID,\n        certificate: certificate,\n        PW: pw,\n        SI: si,\n        KF: kf,\n        IPID: ipid\n      };\n    } catch (error) {\n      console.error('Error parsing save policy response:', error);\n      throw new Error(`Failed to parse save policy response: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  static parseProductListResponse(xmlText: string): TerracottaProductListResponse {\n    try {\n      const parser = new DOMParser();\n      const xmlDoc = parser.parseFromString(xmlText, 'text/xml');\n      \n      const parseError = xmlDoc.querySelector('parsererror');\n      if (parseError) {\n        throw new Error(`XML parsing error: ${parseError.textContent}`);\n      }\n\n      const message = xmlDoc.querySelector('message')?.textContent || '';\n      const resultID = parseInt(xmlDoc.querySelector('errorID')?.textContent || '0');\n      const schemas: TerracottaProduct[] = [];\n\n      const schemaNodes = xmlDoc.querySelectorAll('Schema');\n      schemaNodes.forEach((node: any) => {\n        const schema: TerracottaProduct = {\n          SchemaID: parseInt(node.querySelector('SchemaID')?.textContent || '0'),\n          SchemaName: node.querySelector('SchemaName')?.textContent || ''\n        };\n        schemas.push(schema);\n      });\n\n      return { Message: message, ResultID: resultID, Schemas: schemas };\n    } catch (error) {\n      console.error('Error parsing product list response:', error);\n      throw new Error(`Failed to parse product list response: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  static parsePolicyTypeResponse(xmlText: string): TerracottaPolicyTypeResponse {\n    try {\n      const parser = new DOMParser();\n      const xmlDoc = parser.parseFromString(xmlText, 'text/xml');\n      \n      const parseError = xmlDoc.querySelector('parsererror');\n      if (parseError) {\n        throw new Error(`XML parsing error: ${parseError.textContent}`);\n      }\n\n      const message = xmlDoc.querySelector('message')?.textContent || '';\n      const resultID = parseInt(xmlDoc.querySelector('errorID')?.textContent || '0');\n      const policyTypes: TerracottaPolicyType[] = [];\n\n      const policyTypeNodes = xmlDoc.querySelectorAll('TypePolicy');\n      policyTypeNodes.forEach((node: any) => {\n        const policyType: TerracottaPolicyType = {\n          TypePolicyID: node.querySelector('TypePolicyID')?.textContent || '',\n          TypePolicyName: node.querySelector('Name')?.textContent || '', // Changed from TypePolicyName to Name\n          Description: node.querySelector('IsAnnual')?.textContent === '1' ? 'Annual Policy' : 'Single Trip Policy'\n        };\n        policyTypes.push(policyType);\n      });\n\n      return { Message: message, ResultID: resultID, PolicyTypes: policyTypes };\n    } catch (error) {\n      console.error('Error parsing policy type response:', error);\n      throw new Error(`Failed to parse policy type response: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  static parsePolicyTypeDestinationResponse(xmlText: string): TerracottaPolicyTypeDestinationResponse {\n    try {\n      const parser = new DOMParser();\n      const xmlDoc = parser.parseFromString(xmlText, 'text/xml');\n      \n      const parseError = xmlDoc.querySelector('parsererror');\n      if (parseError) {\n        throw new Error(`XML parsing error: ${parseError.textContent}`);\n      }\n\n      const message = xmlDoc.querySelector('message')?.textContent || '';\n      const resultID = parseInt(xmlDoc.querySelector('errorID')?.textContent || '0');\n      const policyTypeDestinations: TerracottaPolicyTypeDestination[] = [];\n\n      const destinationNodes = xmlDoc.querySelectorAll('PolicyTypeDestination');\n      destinationNodes.forEach((node: any) => {\n        const destination: TerracottaPolicyTypeDestination = {\n          TypePolicyDestinationID: node.querySelector('TypePolicyDestinationID')?.textContent || '',\n          Name: node.querySelector('Name')?.textContent || '',\n          PolicyTypeID: node.querySelector('PolicyTypeID')?.textContent || ''\n        };\n        policyTypeDestinations.push(destination);\n      });\n\n      return { Message: message, ResultID: resultID, PolicyTypeDestinations: policyTypeDestinations };\n    } catch (error) {\n      console.error('Error parsing policy type destination response:', error);\n      throw new Error(`Failed to parse policy type destination response: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n}\n\n/**\n * Main Terracotta Service Class\n */\nexport class TerracottaService {\n  private static instance: TerracottaService;\n  private userID: string;\n  private userCode: string;\n\n  constructor(userID: string = TERRACOTTA_USER_ID, userCode: string = TERRACOTTA_USER_CODE) {\n    this.userID = userID;\n    this.userCode = userCode;\n  }\n\n  static getInstance(userID?: string, userCode?: string): TerracottaService {\n    if (!TerracottaService.instance) {\n      TerracottaService.instance = new TerracottaService(\n        userID || TERRACOTTA_USER_ID, \n        userCode || TERRACOTTA_USER_CODE\n      );\n    }\n    return TerracottaService.instance;\n  }\n\n  /**\n   * Generic SOAP request method\n   */\n  private async makeSOAPRequest(method: string, requestBody: string): Promise<string> {\n    const soapEnvelope = SOAPBuilder.createEnvelope(requestBody);\n    \n    console.log('Making SOAP request via proxy to:', `${PROXY_BASE_URL}/${method}`);\n    console.log('SOAP Envelope:', soapEnvelope);\n    \n    try {\n      const response = await fetch(`${PROXY_BASE_URL}/${method}`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'text/xml; charset=utf-8'\n        },\n        body: soapEnvelope\n      });\n\n      console.log('SOAP Response Status:', response.status, response.statusText);\n      const responseText = await response.text();\n      console.log('SOAP Response Body:', responseText);\n\n      if (!response.ok) {\n        throw new Error(`SOAP request failed: ${response.status} ${response.statusText}`);\n      }\n\n      return responseText;\n    } catch (error) {\n      console.error('Proxy request failed:', error);\n      throw new Error(`Failed to connect to Terracotta API via proxy: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Test connection with HelloWorld method\n   */\n  async testConnection(): Promise<boolean> {\n    try {\n      const soapBody = `\n        <HelloWorld xmlns=\"WS-IntegratedQuote\">\n        </HelloWorld>`;\n\n      const responseText = await this.makeSOAPRequest('HelloWorld', soapBody);\n      console.log('Connection test successful:', responseText);\n      return true;\n    } catch (error) {\n      console.error('Connection test failed:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Get available policy types for a specific schema\n   */\n  async getUserProductTypePolicy(schemaId: string): Promise<TerracottaPolicyTypeResponse> {\n    try {\n      const userID = parseInt(this.userID) || parseInt(TERRACOTTA_USER_ID);\n      const userCode = parseInt(this.userCode) || parseInt(TERRACOTTA_USER_CODE);\n      \n      console.log('getUserProductTypePolicy - schemaId:', schemaId, 'userID:', userID, 'userCode:', userCode);\n      \n      const soapBody = `\n        <GetUserProductTypePolicy xmlns=\"WS-IntegratedQuote\">\n          <userID>${userID}</userID>\n          <userCode>${userCode}</userCode>\n          <schemaId>${schemaId}</schemaId>\n        </GetUserProductTypePolicy>`;\n\n      const responseText = await this.makeSOAPRequest('GetUserProductTypePolicy', soapBody);\n      return XMLParser.parsePolicyTypeResponse(responseText);\n    } catch (error) {\n      console.error('Error in getUserProductTypePolicy:', error);\n      throw new Error(`Failed to get policy types: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Get available destinations for a specific schema\n   */\n  async getUserProductDestination(schemaId: string): Promise<TerracottaPolicyTypeDestinationResponse> {\n    try {\n      const userID = parseInt(this.userID) || parseInt(TERRACOTTA_USER_ID);\n      const userCode = parseInt(this.userCode) || parseInt(TERRACOTTA_USER_CODE);\n      \n      console.log('getUserProductDestination - schemaId:', schemaId, 'userID:', userID, 'userCode:', userCode);\n      \n      const soapBody = `\n        <GetUserProductDestination xmlns=\"WS-IntegratedQuote\">\n          <userID>${userID}</userID>\n          <userCode>${userCode}</userCode>\n          <schemaId>${schemaId}</schemaId>\n        </GetUserProductDestination>`;\n\n      const responseText = await this.makeSOAPRequest('GetUserProductDestination', soapBody);\n      return XMLParser.parsePolicyTypeDestinationResponse(responseText);\n    } catch (error) {\n      console.error('Error in getUserProductDestination:', error);\n      throw new Error(`Failed to get policy type destinations: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Get available products for the user\n   */\n  async getUserProductList(): Promise<TerracottaProductListResponse> {\n    try {\n      const userID = parseInt(this.userID) || parseInt(TERRACOTTA_USER_ID);\n      const userCode = parseInt(this.userCode) || parseInt(TERRACOTTA_USER_CODE);\n      \n      console.log('getUserProductList - userID:', userID, 'userCode:', userCode);\n      console.log('getUserProductList - this.userID:', this.userID, 'this.userCode:', this.userCode);\n      \n      const soapBody = `\n        <GetUserProductList xmlns=\"WS-IntegratedQuote\">\n          <userID>${userID}</userID>\n          <userCode>${userCode}</userCode>\n        </GetUserProductList>`;\n\n      const responseText = await this.makeSOAPRequest('GetUserProductList', soapBody);\n      return XMLParser.parseProductListResponse(responseText);\n    } catch (error) {\n      console.error('Error in getUserProductList:', error);\n      throw new Error(`Failed to get user product list: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * 1. Request for quotations\n   * Calls the ProvideQuotation method to obtain a list of possible quotes\n   */\n  async provideQuotation(request: TerracottaQuoteRequest): Promise<TerracottaQuoteResponse> {\n    try {\n      console.log('🚀 Building SOAP request for ProvideQuotation...');\n      console.log('📦 Request object:', request);\n      \n      const quoteDetailsXML = SOAPBuilder.buildQuoteDetailsXML(request.quoteDetails);\n      console.log('📄 Quote Details XML:', quoteDetailsXML);\n      \n      const soapBody = `\n        <ProvideQuotation xmlns=\"WS-IntegratedQuote\">\n          <userID>${parseInt(request.userID)}</userID>\n          <userCode>${parseInt(request.userCode)}</userCode>\n          ${quoteDetailsXML}\n        </ProvideQuotation>`;\n\n      console.log('📤 Complete SOAP Body:', soapBody);\n      console.log('🌐 Sending SOAP request to:', `${PROXY_BASE_URL}/ProvideQuotation`);\n      \n      const responseText = await this.makeSOAPRequest('ProvideQuotation', soapBody);\n      \n      console.log('📥 Raw SOAP Response received');\n      console.log('📄 Response length:', responseText.length, 'characters');\n      console.log('📄 First 500 chars of response:', responseText.substring(0, 500));\n      \n      const parsedResponse = XMLParser.parseQuoteResponse(responseText);\n      console.log('✅ Parsed response:', parsedResponse);\n      \n      return parsedResponse;\n    } catch (error) {\n      console.error('❌ Error in provideQuotation:', error);\n      console.error('❌ Error type:', error instanceof Error ? error.constructor.name : typeof error);\n      console.error('❌ Error message:', error instanceof Error ? error.message : String(error));\n      throw new Error(`Failed to get quotes from Terracotta: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * 3. Obtain Screening Questions\n   * Calls ScreeningQuestions to get screening questions for the selected quote\n   */\n  async getScreeningQuestions(quoteID: string): Promise<TerracottaScreeningQuestionsResponse> {\n    try {\n      console.log('🔄 Building SOAP request for ScreeningQuestions...');\n      console.log('📦 QuoteID:', quoteID);\n      console.log('👤 UserID:', this.userID, 'UserCode:', this.userCode);\n      \n      const soapBody = `\n        <ScreeningQuestions xmlns=\"WS-IntegratedQuote\">\n          <userID>${parseInt(this.userID) || parseInt(TERRACOTTA_USER_ID)}</userID>\n          <userCode>${parseInt(this.userCode) || parseInt(TERRACOTTA_USER_CODE)}</userCode>\n          <quoteID>${quoteID}</quoteID>\n        </ScreeningQuestions>`;\n\n      console.log('📤 SOAP Body for ScreeningQuestions:', soapBody);\n      \n      const responseText = await this.makeSOAPRequest('ScreeningQuestions', soapBody);\n      \n      console.log('📥 Raw Response from ScreeningQuestions:', responseText.substring(0, 1000));\n      \n      const parsed = XMLParser.parseScreeningQuestionsResponse(responseText);\n      console.log('✅ Parsed Screening Questions Response:', parsed);\n      console.log('📋 Number of questions:', parsed.screeningQuestions?.length || 0);\n      \n      if (parsed.screeningQuestions && parsed.screeningQuestions.length > 0) {\n        console.log('📝 Questions details:');\n        parsed.screeningQuestions.forEach((q, idx) => {\n          console.log(`  ${idx + 1}. Q${q.questionNumber}: ${q.question}`);\n        });\n      }\n      \n      return parsed;\n    } catch (error) {\n      console.error('❌ Error in getScreeningQuestions:', error);\n      console.error('Error type:', error instanceof Error ? error.constructor.name : typeof error);\n      console.error('Error message:', error instanceof Error ? error.message : String(error));\n      throw new Error(`Failed to get screening questions: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * 2. Update quotes with additional covers\n   * Calls ProvideQuotationWithAlterations to get quotes with specific alterations/add-ons\n   * This method can only be called AFTER obtaining a quote reference from ProvideQuotation\n   */\n  async provideQuotationWithAlterations(request: TerracottaQuoteWithAlterationsRequest): Promise<TerracottaQuoteResponse> {\n    try {\n      console.log('🚀 Building SOAP request for ProvideQuotationWithAlterations...');\n      console.log('📦 Request object:', request);\n      \n      const specificQuoteDetailsXML = SOAPBuilder.buildSpecificQuoteDetailsXML(request.specificQuoteDetails);\n      console.log('📄 Specific Quote Details XML:', specificQuoteDetailsXML);\n      \n      const soapBody = `\n        <ProvideQuotationWithAlterations xmlns=\"WS-IntegratedQuote\">\n          <userID>${parseInt(request.userID)}</userID>\n          <userCode>${parseInt(request.userCode)}</userCode>\n          <quoteID>${request.quoteID}</quoteID>\n          ${specificQuoteDetailsXML}\n        </ProvideQuotationWithAlterations>`;\n\n      console.log('📤 Complete SOAP Body:', soapBody);\n      console.log('🌐 Sending SOAP request to:', `${PROXY_BASE_URL}/ProvideQuotationWithAlterations`);\n      \n      const responseText = await this.makeSOAPRequest('ProvideQuotationWithAlterations', soapBody);\n      \n      console.log('📥 Raw SOAP Response received');\n      console.log('📄 Response length:', responseText.length, 'characters');\n      console.log('📄 First 500 chars of response:', responseText.substring(0, 500));\n      \n      const parsedResponse = XMLParser.parseQuoteResponse(responseText);\n      console.log('✅ Parsed response:', parsedResponse);\n      \n      return parsedResponse;\n    } catch (error) {\n      console.error('❌ Error in provideQuotationWithAlterations:', error);\n      console.error('❌ Error type:', error instanceof Error ? error.constructor.name : typeof error);\n      console.error('❌ Error message:', error instanceof Error ? error.message : String(error));\n      throw new Error(`Failed to get quotes with alterations from Terracotta: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * 3. Save a quote as a Live policy\n   * Calls SavePolicyDetails to convert the quote into a live policy\n   */\n  async savePolicyDetails(request: TerracottaSavePolicyRequest): Promise<TerracottaSavePolicyResponse> {\n    try {\n      console.log('🚀 Building SOAP request for SavePolicyDetails...');\n      console.log('📦 Request object:', request);\n      \n      const screeningAnswersXML = SOAPBuilder.buildScreeningAnswersXML(request.screeningQuestionAnswers);\n      \n      const soapBody = `\n        <SavePolicyDetails xmlns=\"WS-IntegratedQuote\">\n          <userID>${parseInt(request.userID)}</userID>\n          <userCode>${parseInt(request.userCode)}</userCode>\n          <quoteID>${request.quoteID}</quoteID>\n          ${screeningAnswersXML}\n          ${request.medicalScreeningReference ? `<medicalScreeningReference>${request.medicalScreeningReference}</medicalScreeningReference>` : '<medicalScreeningReference>string</medicalScreeningReference>'}\n          ${request.useDefaultAnswers !== undefined ? `<useDefaultAnswers>${request.useDefaultAnswers}</useDefaultAnswers>` : '<useDefaultAnswers>1</useDefaultAnswers>'}\n        </SavePolicyDetails>`;\n\n      console.log('📤 Complete SOAP Body for SavePolicyDetails:', soapBody);\n      console.log('🌐 Sending SOAP request to:', `${PROXY_BASE_URL}/SavePolicyDetails`);\n\n      const responseText = await this.makeSOAPRequest('SavePolicyDetails', soapBody);\n      \n      console.log('📥 Raw SOAP Response from SavePolicyDetails:', responseText);\n      \n      const parsedResponse = XMLParser.parseSavePolicyResponse(responseText);\n      console.log('✅ Parsed SavePolicyDetails response:', parsedResponse);\n      \n      return parsedResponse;\n    } catch (error) {\n      console.error('❌ Error in savePolicyDetails:', error);\n      throw new Error(`Failed to save policy details: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Utility method to convert frontend data to Terracotta format\n   */\n  static convertToTerracottaFormat(formData: any, availablePolicyTypes?: TerracottaPolicyType[]): TerracottaQuoteRequest {\n    console.log('Converting form data to Terracotta format:', formData);\n    \n    // Convert travelers to Terracotta format using actual user data\n    const travelers: TerracottaTraveler[] = formData.travelers.map((traveler: any, index: number) => {\n      // Prioritize date of birth over age for accuracy\n      const dateOfBirth = traveler.dateOfBirth || calculateDateOfBirth(parseInt(traveler.age));\n      const calculatedAge = traveler.dateOfBirth ? \n        calculateAgeFromDateOfBirth(traveler.dateOfBirth) : \n        parseInt(traveler.age);\n      \n      console.log(`Traveler ${index + 1}: DOB=${dateOfBirth}, Age=${calculatedAge}`);\n      \n      return {\n        TravellerNumber: index + 1,\n        Title: traveler.title || 'Mr', // Use actual title from form\n        FirstName: traveler.firstName,\n        LastName: traveler.lastName,\n        DateOfBirth: formatDateForTerracotta(dateOfBirth),\n        Age: calculatedAge,\n        AgebandID: getAgebandID(calculatedAge),\n        TitleID: getTitleID(traveler.title || 'Mr'),\n        minAge: calculatedAge,\n        maxAge: calculatedAge,\n        ScreeningInformation: null\n      };\n    });\n\n    // Convert contact details using actual user data\n    const contactDetails: TerracottaContactDetails = {\n      Address: formData.billingAddress?.street || formData.contactAddress?.street || '123 Main Street',\n      Postcode: formData.billingAddress?.postalCode || formData.contactAddress?.postalCode || '12345',\n      Email: formData.travelers[0]?.email || formData.contactEmail || 'test@example.com',\n      Telephone: formData.travelers[0]?.phone || formData.contactPhone || '+30123456789',\n      VehicleMakeModel: formData.vehicleMakeModel,\n      VehicleLicensePlate: formData.vehicleLicensePlate,\n      VehicleYearManufacture: formData.vehicleYearManufacture\n    };\n\n           // Convert trip details using actual user data\n           const quoteDetails: TerracottaQuoteDetails = {\n             ResidenceID: getResidenceID(formData.countryOfResidence),\n             TypePolicyID: getTypePolicyID(formData.tripType, availablePolicyTypes),\n             TypePackageID: '1', // Fixed value as requested (string)\n             Destination: formData.destination || 'Europe',\n             StartDate: formatDateForTerracotta(formData.startDate),\n             EndDate: formatDateForTerracotta(formData.endDate),\n             Travellers: travelers,\n             ContactDetails: contactDetails,\n             includeAnnualQuotes: formData.tripType === 'annual' ? 1 : 0,\n             includeUpsell: 0, // Simplified for now\n             currencyID: 1, // EUR\n             schemaIDFilter: '717' // Use schema 717\n           };\n\n    console.log('Converted Terracotta request:', quoteDetails);\n    \n    // Use fixed values as requested\n    return {\n      userID: '4072',\n      userCode: '111427',\n      quoteDetails\n    };\n  }\n}\n\n/**\n * Utility functions for data conversion\n */\n\nfunction formatDateForTerracotta(dateString: string): string {\n  if (!dateString) return '';\n  \n  // Handle different date formats\n  if (dateString.includes('/')) {\n    // Handle DD/MM/YYYY format\n    const parts = dateString.split('/');\n    if (parts.length === 3) {\n      const [day, month, year] = parts;\n      return `${year}/${month}/${day}`;\n    }\n  }\n  \n  // Handle YYYY-MM-DD format\n  if (dateString.includes('-')) {\n    return dateString.replace(/-/g, '/');\n  }\n  \n  return dateString;\n}\n\nfunction calculateDateOfBirth(age: number): string {\n  const currentYear = new Date().getFullYear();\n  const birthYear = currentYear - age;\n  // Use January 1st as default date\n  return `${birthYear}/01/01`;\n}\n\nfunction calculateAgeFromDateOfBirth(dateOfBirth: string): number {\n  const birthDate = new Date(dateOfBirth);\n  const today = new Date();\n  let age = today.getFullYear() - birthDate.getFullYear();\n  const monthDiff = today.getMonth() - birthDate.getMonth();\n  \n  if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {\n    age--;\n  }\n  \n  return Math.max(0, age);\n}\n\nfunction getResidenceID(country: string): string {\n  // Map countries to Terracotta Residence IDs\n  // Based on Terracotta API - Greece is ResidenceID 24\n  const residenceMap: { [key: string]: string } = {\n    'Greece': '24',     // Correct ResidenceID for Greece\n    'Austria': '4',\n    'Belgium': '6',\n    'Bulgaria': '10',\n    'Croatia (Hrvatska)': '14',\n    'Czech Republic': '16',\n    'Denmark': '17',\n    'Estonia': '20',\n    'Finland': '21',\n    'France': '22',\n    'Germany': '23',\n    'Hungary': '27',\n    'Iceland': '28',\n    'Italy': '33',\n    'Latvia': '38',\n    'Liechtenstein': '40',\n    'Lithuania': '41',\n    'Luxembourg': '42',\n    'Malta': '93',\n    'Netherlands': '47',\n    'Norway': '49',\n    'Poland': '53',\n    'Portugal': '54',\n    'Republic of Cyprus': '283',\n    'Republic of Ireland': '19',\n    'Romania': '55',\n    'Slovak Republic': '59',\n    'Slovenia': '60',\n    'Spain': '62',\n    'Sweden': '63'\n  };\n  \n  return residenceMap[country] || '24'; // Default to Greece\n}\n\nfunction getTypePolicyID(tripType: string, availablePolicyTypes?: TerracottaPolicyType[]): string {\n  // If we have SOAP data, use it to find the correct TypePolicyID\n  if (availablePolicyTypes && availablePolicyTypes.length > 0) {\n    const policyType = availablePolicyTypes.find(pt => {\n      const name = pt.TypePolicyName.toLowerCase();\n      switch (tripType) {\n        case 'single':\n          return name.includes('single') && !name.includes('annual');\n        case 'annual':\n          return name.includes('annual') || name.includes('multi-trip');\n        case 'longstay':\n          return name.includes('longstay') || name.includes('long stay');\n        case 'comprehensive':\n          return name.includes('comprehensive');\n        default:\n          return false;\n      }\n    });\n    \n    if (policyType) {\n      console.log(`✅ Found TypePolicyID ${policyType.TypePolicyID} for trip type '${tripType}' (${policyType.TypePolicyName})`);\n      return policyType.TypePolicyID;\n    }\n  }\n  \n  // Fallback to hardcoded mappings if SOAP data not available\n  console.log(`⚠️ Using fallback mapping for trip type '${tripType}'`);\n  const policyMap: { [key: string]: string } = {\n    'single': '2',        // Single Trip TypePolicyID\n    'annual': '23',       // Annual Multi-Trip TypePolicyID\n    'longstay': '3',      // Longstay TypePolicyID\n    'comprehensive': '2'  // Use Single Trip as default\n  };\n  \n  return policyMap[tripType] || '2'; // Default to Single Trip TypePolicyID\n}\n\nfunction getTypePackageID(tripType: string): string {\n  // Use correct Package IDs (not SchemaIDs)\n  // Package IDs are typically 1, 2, 3, etc. for different coverage levels\n  const packageMap: { [key: string]: string } = {\n    'single': '1',        // Basic package for single trip\n    'annual': '1',        // Basic package for annual\n    'comprehensive': '2'  // Higher coverage package\n  };\n  \n  return packageMap[tripType] || '1'; // Default to basic package\n}\n\nfunction getAgebandID(age: number): number {\n  // Map age to Terracotta Ageband ID\n  if (age <= 17) return 1;\n  if (age <= 30) return 2;\n  if (age <= 40) return 3;\n  if (age <= 50) return 4;\n  if (age <= 60) return 5;\n  if (age <= 70) return 6;\n  return 7; // 70+\n}\n\nfunction getTitleID(title: string): number {\n  // Map title to Terracotta Title ID\n  const titleMap: { [key: string]: number } = {\n    'Mr': 1,\n    'Mrs': 2,\n    'Miss': 3,\n    'Ms': 4,\n    'Dr': 5,\n    'Prof': 6\n  };\n  \n  return titleMap[title] || 1; // Default to Mr\n}\n\nfunction getCurrencyID(currency: string): number {\n  // Map currency to Terracotta Currency ID\n  const currencyMap: { [key: string]: number } = {\n    'EUR': 1,\n    'USD': 2,\n    'GBP': 3,\n    'CHF': 4\n  };\n  \n  return currencyMap[currency] || 1; // Default to EUR\n}\n\nexport default TerracottaService;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}